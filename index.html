<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic -->
    <link rel="icon" href="/favicon.ico" sizes="any"><!-- .ico with embedded 16 & 32 px -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">

    <!-- Optional extras -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png"><!-- iOS home-screen -->
    <meta name="theme-color" content="#ffffff"><!-- address-bar tint on mobile Chrome -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FERAL Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 font-inter text-gray-800 antialiased">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Main App Component
        function App() {
            const [activeSection, setActiveSection] = useState('home');
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);

            const handleNavClick = (section) => {
                setActiveSection(section);
                setIsSidebarOpen(false);
                document.getElementById(section)?.scrollIntoView({ behavior: 'smooth' });
            };

            return (
                <div className="min-h-screen bg-gray-100 font-inter text-gray-800 antialiased flex flex-col">
                    {/* Header */}
                    <header className="bg-white shadow-sm py-4 px-6 md:px-8 flex flex-col md:flex-row items-center justify-between sticky top-0 z-50">
                        <div className="flex items-center justify-center md:justify-start w-full md:w-auto relative mb-2 md:mb-0">
                            <button
                                className="md:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 absolute left-0"
                                onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                                aria-label="Toggle navigation"
                            >
                                <svg className="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    {isSidebarOpen ? (
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                    ) : (
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" />
                                    )}
                                </svg>
                            </button>
                            <img
                                src="./src/images/feral-logo.png"
                                alt="Feral AI Logo"
                                className="h-8 w-8 mr-2 ml-10 md:ml-0"
                            />
                            <h1 className="text-3xl font-bold text-gray-900">FERAL</h1>
                            <a
  href="https://github.com/Skovorp/feral"
  target="_blank"
  rel="noopener noreferrer"
  className="ml-4 text-gray-700 hover:text-gray-900"
  title="View on GitHub"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    fill="currentColor"
    className="w-7 h-7"
  >
    <path d="M12 .5C5.37.5 0 5.87 0 12.5c0 5.3 3.438 9.8 8.205 11.39.6.113.82-.26.82-.577v-2.173c-3.338.726-4.033-1.61-4.033-1.61-.546-1.387-1.333-1.757-1.333-1.757-1.09-.746.083-.73.083-.73 1.205.085 1.84 1.238 1.84 1.238 1.07 1.835 2.808 1.305 3.495.998.108-.775.418-1.305.76-1.605-2.665-.3-5.466-1.333-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.125-.303-.54-1.523.115-3.176 0 0 1.005-.323 3.3 1.23a11.49 11.49 0 0 1 3-.403c1.02.005 2.045.137 3 .403 2.295-1.553 3.3-1.23 3.3-1.23.655 1.653.24 2.873.12 3.176.77.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.43.37.81 1.1.81 2.22v3.293c0 .32.22.694.825.576C20.565 22.295 24 17.795 24 12.5 24 5.87 18.63.5 12 .5z" />
  </svg>
</a>
                        </div>
                        <nav className="hidden md:flex space-x-6 mt-4 md:mt-0">
                            <NavLink section="home" current={activeSection} onClick={handleNavClick}>Home</NavLink>
                            <NavLink section="getting-started" current={activeSection} onClick={handleNavClick}>Getting Started</NavLink>
                            <NavLink section="video-preparation" current={activeSection} onClick={handleNavClick}>Video Preparation</NavLink>
                            <NavLink section="label-preparation" current={activeSection} onClick={handleNavClick}>Label Preparation</NavLink>
                            <NavLink section="dataset-validator" current={activeSection} onClick={handleNavClick}>Dataset Validator</NavLink>
                            <NavLink section="running-feral" current={activeSection} onClick={handleNavClick}>Running Feral</NavLink>
                            <NavLink section="colab" current={activeSection} onClick={handleNavClick}>Google Colab</NavLink>
                            <NavLink section="runpod" current={activeSection} onClick={handleNavClick}>RunPod</NavLink>
                            <NavLink section="contact" current={activeSection} onClick={handleNavClick}>Contact</NavLink>
                        </nav>
                    </header>

                    {/* Main Content Area */}
                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar */}
                        <aside className={`fixed inset-y-0 left-0 transform ${isSidebarOpen ? 'translate-x-0 pt-20' : '-translate-x-full'} md:relative md:translate-x-0 w-64 bg-white shadow-lg p-6 overflow-y-auto transition-transform duration-300 ease-in-out z-40 md:z-auto`}>
                            <nav className="space-y-2">
                                <SidebarLink section="home" current={activeSection} onClick={handleNavClick}>Introduction</SidebarLink>
                                <SidebarLink section="getting-started" current={activeSection} onClick={handleNavClick}>Getting Started</SidebarLink>
                                <SidebarLink section="video-preparation" current={activeSection} onClick={handleNavClick}>Video Preparation</SidebarLink>
                                <SidebarLink section="label-preparation" current={activeSection} onClick={handleNavClick}>Label Preparation</SidebarLink>
                                <SidebarLink section="dataset-validator" current={activeSection} onClick={handleNavClick}>Dataset Validator</SidebarLink>
                                <SidebarLink section="running-feral" current={activeSection} onClick={handleNavClick}>Running Feral</SidebarLink>
                                <SidebarLink section="colab" current={activeSection} onClick={handleNavClick}>Google Colab</SidebarLink>
                                <SidebarLink section="runpod" current={activeSection} onClick={handleNavClick}>RunPod</SidebarLink>
                                <SidebarLink section="examples" current={activeSection} onClick={handleNavClick}>Examples</SidebarLink>

                                
                                <SidebarLink section="contact" current={activeSection} onClick={handleNavClick}>Contact Us</SidebarLink>
                                <div className="mt-6 flex items-center space-x-2 text-gray-700 hover:text-gray-900 transition-colors">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    fill="currentColor"
    className="w-5 h-5"
  >
    <path d="M12 .5C5.37.5 0 5.87 0 12.5c0 5.3 3.438 9.8 8.205 11.39.6.113.82-.26.82-.577v-2.173c-3.338.726-4.033-1.61-4.033-1.61-.546-1.387-1.333-1.757-1.333-1.757-1.09-.746.083-.73.083-.73 1.205.085 1.84 1.238 1.84 1.238 1.07 1.835 2.808 1.305 3.495.998.108-.775.418-1.305.76-1.605-2.665-.3-5.466-1.333-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.125-.303-.54-1.523.115-3.176 0 0 1.005-.323 3.3 1.23a11.49 11.49 0 0 1 3-.403c1.02.005 2.045.137 3 .403 2.295-1.553 3.3-1.23 3.3-1.23.655 1.653.24 2.873.12 3.176.77.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.43.37.81 1.1.81 2.22v3.293c0 .32.22.694.825.576C20.565 22.295 24 17.795 24 12.5 24 5.87 18.63.5 12 .5z" />
  </svg>
  <a
    href="https://github.com/Skovorp/feral"
    target="_blank"
    rel="noopener noreferrer"
    className="text-sm font-medium hover:underline"
  >
    View on GitHub
  </a>
</div>
                            </nav>
                        </aside>

                        {/* Content Area */}
                        <main className="flex-1 p-0 md:p-8 overflow-y-auto">
                            {activeSection === 'home' && <HomeSection handleNavClick={handleNavClick} />}
                            {activeSection === 'getting-started' && <GettingStartedSection handleNavClick={handleNavClick} />}
                            {activeSection === 'video-preparation' && <VideoPreparationSection />}
                            {activeSection === 'label-preparation' && <LabelPreparationSection />}
                            {activeSection === 'running-feral' && <RunningFeralSection handleNavClick={handleNavClick} />}
                            {activeSection === 'colab' && <ColabSection />}
                            {activeSection === 'runpod' && <RunPodSection />}
                            {activeSection === 'dataset-validator' && <DatasetValidatorSection />}
                            {activeSection === 'examples' && <ExamplesSection />}
                            {activeSection === 'contact' && <ContactSection />}
                        </main>
                    </div>

                    {/* Overlay for mobile sidebar */}
                    {isSidebarOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden" onClick={() => setIsSidebarOpen(false)}></div>
                    )}

                    {/* Footer */}
                    <footer className="bg-gray-900 text-white py-6 px-8 text-center text-sm">
                        <p>&copy; {new Date().getFullYear()} Feral AI. All rights reserved.</p>
                        <p className="mt-2">
                            <a href="/privacy-policy" className="text-gray-400 hover:underline mx-2">Privacy Policy</a> |
                            <a href="/terms-of-service" className="text-gray-400 hover:underline mx-2">Terms of Service</a>
                        </p>
                    </footer>
                </div>
            );
        }

        // Navigation Components
        const NavLink = ({ section, current, onClick, children }) => (
            <button
                className={`px-3 py-2 rounded-md text-sm font-medium ${current === section ? 'bg-gray-200 text-gray-900' : 'text-gray-700 hover:bg-gray-100 hover:text-gray-900'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300`}
                onClick={() => onClick(section)}
            >
                {children}
            </button>
        );

        const SidebarLink = ({ section, current, onClick, children }) => (
            <button
                className={`block w-full text-left px-3 py-2 rounded-md text-sm ${current === section ? 'bg-gray-200 text-gray-900 font-semibold' : 'text-gray-700 hover:bg-gray-50 hover:text-gray-900'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300`}
                onClick={() => onClick(section)}
            >
                {children}
            </button>
        );
        
        // ===== Hero Mosaic (GIFs) =====
const HeroMosaic = () => (
  <div className="mt-6 grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4">
    {/* Main tile – bird */}
    <figure className="col-span-2 md:col-span-2 md:row-span-2 overflow-hidden rounded-xl border border-gray-200 shadow-sm">
      <img
        src="./src/videos/bird_example.gif"
        alt="Bird example behavior"
        loading="lazy"
        className="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
      />
      <figcaption className="sr-only">Bird example</figcaption>
    </figure>

    {/* Side tiles – replace filenames with your two other GIFs */}
    <figure className="overflow-hidden rounded-xl border border-gray-200 shadow-sm">
      <img
        src="src\videos\ants_example.gif"  /* ← change if different */
        alt="Ants example behavior"
        loading="lazy"
        className="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
      />
      <figcaption className="sr-only">Ants example</figcaption>
    </figure>

    <figure className="overflow-hidden rounded-xl border border-gray-200 shadow-sm">
      <img
        src="src\videos\worms_example.gif" /* ← change if different */
        alt="Worms example behavior"
        loading="lazy"
        className="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
      />
      <figcaption className="sr-only">Worms example</figcaption>
    </figure>
  </div>
);


        // Content Sections
        const HomeSection = ({ handleNavClick }) => (
  <section id="home" className="bg-white rounded-lg shadow-md pb-8">
    <div className="p-8">
      <h2 className="text-3xl font-bold text-gray-900 mb-4">About FERAL</h2>
                    
                    <p className="text-gray-700 leading-relaxed mb-4">
                        
                        AI is advancing at lightning speed: new models arrive every month, and their quality is improving exponentially. To put that power in the hands of biologists, we created FERAL.
                    </p>
                    
                    <p className="text-gray-700 leading-relaxed mb-4">
                        FERAL (Feature Extraction for Recognition of Animal Locomotion) is an open-source solution that segments animal behavior directly 
                        from raw videos: <strong> no tracking, no pose estimation required </strong>. FERAL uses cutting‑edge opensource video‑understanding 
                        models in a pipeline tailored for behavior segmentation. 
                        This enables automated behavior analysis in complex lab and field recordings where earlier methods struggled. 
                        On existing benchmarks, it beats the previous state of the art by a wide margin (more info coming soon!).
                    </p>

                    <p className="text-gray-700 leading-relaxed mb-4">
                        You don’t need key-point tracking, just raw videos and labels. Set everything up in the cloud in 
                        under five minutes and run it with a single command. If you encounter any issues, please reach out 
                        through the “Contact” section. We’ll be happy to assist with anything you need.
                    </p>

                    <div className="mt-6 flex flex-wrap gap-4">
                        <button
                            onClick={() => handleNavClick('getting-started')}
                            className="bg-gray-900 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1"
                        >
                            Get Started

                        
                        </button>
                    </div>
                </div>    

                {/* Acknowledgment Section */}
                <div className="sm:mx-6 bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <h3 className="text-xl font-semibold text-gray-900 mb-4">👨‍🔬 Acknowledgments</h3>
                    <p className="text-gray-700 leading-relaxed mb-4">
                        FERAL was developed at <strong>The Rockefeller University</strong> by:
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {/* Peter’s tile */}
                        <div className="bg-white p-4 rounded-lg border border-gray-100 relative pr-16 md:pr-32">
                            {/* LEFT content */}
                            <div className="flex items-center mb-2">
                            <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <span className="text-green-600 font-semibold text-sm">PS</span>
                            </div>
                            <div>
                                <h4 className="font-semibold text-gray-900">Peter Skovorodnikov</h4>
                                <p className="text-sm text-gray-600">Researcher &amp; Lead Developer</p>
                            </div>
                            </div>
                        
                            <p className="text-sm text-gray-700 mb-1">
                            <a href="mailto:pskovorodnikov@rockefeller.edu" className="text-blue-600 hover:underline">
                                pskovorodnikov@rockefeller.edu
                            </a>
                            </p>
                            <p className="text-sm text-gray-600">
                            <a href="https://aiml.rockefeller.edu/" className="text-blue-600 hover:underline" target="_blank" rel="noopener noreferrer">
                                Data Science Platform
                            </a>
                            </p>
                        
                            {/* LOGO */}
                            <img
                                src="src/images/rockefeller_logo.png"
                                alt="Rockefeller University Logo"
                                className="
                                absolute right-4 bottom-4        /* mobile / narrow default */
                                sm:top-1/2 sm:-translate-y-1/2   /* ≥640 px : move to center */
                                sm:bottom-auto
                                h-16 sm:h-20 opacity-80          /* slightly smaller on mobile */
                                "
                            />
                        </div>
                        
                        {/* Jacopo’s tile */}
                        <div className="bg-white p-4 rounded-lg border border-gray-100 relative pr-16 md:pr-32">
                            <div className="flex items-center mb-2">
                            <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <span className="text-blue-600 font-semibold text-sm">JR</span>
                            </div>
                            <div>
                                <h4 className="font-semibold text-gray-900">Jacopo Razzauti</h4>
                                <p className="text-sm text-gray-600">Co‑Developer &amp; Researcher</p>
                            </div>
                            </div>
                        
                            <p className="text-sm text-gray-700 mb-1">
                            <a href="mailto:jrazzauti@rockefeller.edu" className="text-blue-600 hover:underline">
                                jrazzauti@rockefeller.edu
                            </a>
                            </p>
                            <p className="text-sm text-gray-600">
                            <a href="https://www.rockefeller.edu/research/2355-vosshall-laboratory/" className="text-blue-600 hover:underline" target="_blank" rel="noopener noreferrer">
                                Laboratory of Neurogenetics and Behavior
                            </a>
                            </p>
                        
                            <img
                                src="src/images/rockefeller_logo.png"
                                alt="Rockefeller University Logo"
                                className="
                                absolute right-4 bottom-4        /* mobile / narrow default */
                                sm:top-1/2 sm:-translate-y-1/2   /* ≥640 px : move to center */
                                sm:bottom-auto
                                h-16 sm:h-20 opacity-80          /* slightly smaller on mobile */
                                "
                            />
                        </div>
                    </div>
                </div>
                <HeroMosaic />                                
            </section>
        );

const GettingStartedSection = ({ handleNavClick }) => (
  <section
    id="getting-started"
    className="bg-white p-8 rounded-lg shadow-md"
  >
    <h2 className="text-3xl font-bold text-gray-900 mb-4">Getting Started</h2>

    {/* High-level intro */}
    <p className="text-gray-700 leading-relaxed mb-6">
      To use FERAL you need to have (1) videos and (2) discrete behavior
      labels for some of these videos. FERAL trains a deep learning model
      using labels you provide, evaluates quality, and predicts labels for
      unannotated videos.
    </p>

    <p className="text-gray-700 leading-relaxed mb-6">
      FERAL workflow has <strong>3 stages</strong>:
    </p>

    <ol className="space-y-6 md:space-y-4 list-decimal list-inside">
      <li>
        <span className="font-semibold text-gray-900">Prepare your videos.</span>{" "}
        FERAL needs seek-able video files (quickly load frames from the middle of the video)
        <button
          onClick={() => handleNavClick("video-preparation")}
          className="ml-2 text-blue-600 hover:underline text-sm"
        >
          (see Video&nbsp;Preparation)
        </button>
      </li>

      <li>
        <span className="font-semibold text-gray-900">Prepare your labels.</span>{" "}
        Convert annotations into the JSON schema FERAL expects
        <button
          onClick={() => handleNavClick("label-preparation")}
          className="ml-2 text-blue-600 hover:underline text-sm"
        >
          (see Label&nbsp;Preparation)
        </button>
      </li>

      <li>
        <span className="font-semibold text-gray-900">Run FERAL.</span>{" "}
        Train a model on your dataset and generate labels for unannotated videos.
        <button
          onClick={() => handleNavClick("colab")}
          className="ml-2 text-blue-600 hover:underline text-sm"
        >
          (how to run)
        </button>
      </li>
    </ol>

    {/* How to run */}
    <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-4">
      Choose how to run FERAL
    </h3>

    <div className="grid grid-cols-1 gap-6">
      {/* A. Local install */}
      <div className="bg-blue-50 border border-blue-200 p-6 rounded-lg">
        <div className="flex items-center mb-3">
          <div className="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold mr-3">
            A
          </div>
          <h4 className="text-lg font-semibold text-blue-900">
            Local Installation
          </h4>
        </div>

        <p className="text-sm text-blue-800 mb-4">
          Best for users with their own GPUs and command-line experience.
        </p>

        <ul className="text-blue-700 text-sm space-y-1">
          <li>💻 Install CUDA + PyTorch yourself</li>
          <li>🔒 Data never leaves your machine</li>
          <li>💸 Completely free</li>
        </ul>

        <button
          onClick={() => handleNavClick("running-feral")}
          className="mt-4 inline-block bg-gray-900 hover:bg-gray-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
        >
          💻 Run Locally
        </button>
      </div>

      {/* B. Google Colab */}
      <div className="bg-green-50 border border-green-200 p-6 rounded-lg">
        <div className="flex items-center mb-3">
          <div className="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold mr-3">
            B
          </div>
          <h4 className="text-lg font-semibold text-green-900">
            Google Colab (Recommended)
          </h4>
        </div>

        <p className="text-sm text-green-800 mb-4">
          Run FERAL fully in your browser using our Colab notebook.
          No installs, no drivers, no cluster.
        </p>

        <ul className="text-green-700 text-sm space-y-1">
          <li>🚀 Zero setup: open and run</li>
          <li>⚡ Use an <code>A100</code> or <code>L4</code> GPU</li>
          <li>🎓 Colab Pro is free for academics (institutional email)</li>
          <li>☁️ Data can stay in your Drive</li>
        </ul>

        <div className="flex flex-wrap gap-3 mt-4">
          <button
            onClick={() => handleNavClick("colab")}
            className="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
          >
            🚀 Run on Google Colab
          </button>

          
        </div>
      </div>

      {/* C. RunPod / dedicated remote GPU */}
      <div className="bg-indigo-50 border border-indigo-200 p-6 rounded-lg">
        <div className="flex items-center mb-3">
          <div className="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold mr-3">
            C
          </div>
          <h4 className="text-lg font-semibold text-indigo-900">
            RunPod Cloud GPU
          </h4>
        </div>

        <p className="text-sm text-indigo-800 mb-4">
          Spin up your own remote GPU server with full control. Best if you
          have lots of data and want persistent storage.
        </p>

        <ul className="text-indigo-700 text-sm space-y-1">
          <li>☁️ Your own long-running GPU pod</li>
          <li>🏎 Access to A100 / H100 class GPUs</li>
          <li>💳 Pay-as-you-go billing</li>
        </ul>

        <button
          onClick={() => handleNavClick("runpod")}
          className="mt-4 inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
        >
          ☁️ Run on RunPod
        </button>
      </div>
    </div>

    {/* Bottom quick links */}
    <div className="mt-10 flex flex-wrap gap-4">
      <button
        onClick={() => handleNavClick("video-preparation")}
        className="bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
      >
        📽️ Video Prep
      </button>
      <button
        onClick={() => handleNavClick("label-preparation")}
        className="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
      >
        🏷️ Label Prep
      </button>
      <button
        onClick={() => handleNavClick("colab")}
        className="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
      >
        🚀 Run FERAL
      </button>
    </div>
  </section>
);

  

        const VideoPreparationSection = () => {
            const [isCodeExpanded, setIsCodeExpanded] = useState(false);
            const [copySuccess, setCopySuccess] = useState(false);

            const reencodingScript = `#!/usr/bin/env python3
"""
FERAL Video Re-encoding Script with Auto-FFmpeg Installation
Converts videos to the required format for FERAL processing.

Features:
- Automatically downloads and sets up FFmpeg if not installed
- Cross-platform support (Windows, macOS, Linux)
- Parallel processing for faster conversion
- Progress tracking and error handling

Usage:
    python reencode_videos.py /path/to/input/videos /path/to/output/videos

Requirements:
    - Python 3.6+
    - Internet connection (for FFmpeg auto-download if needed)
"""

import os
import sys
import subprocess
import argparse
import platform
import urllib.request
import zipfile
import tarfile
from multiprocessing import Pool
import mimetypes
from pathlib import Path

# FFmpeg download URLs for different platforms
FFMPEG_URLS = {
    'Windows': 'https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip',
    'Darwin': 'https://evermeet.cx/ffmpeg/ffmpeg-7.1.zip',
    'Linux': 'https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz'
}

def get_platform():
    import platform
    sysname = platform.system()
    if sysname in ('Darwin', 'Windows'):
        return sysname
    else:
        return 'Linux'

def download_file(url, filename):
    """Download a file with progress indication."""
    print(f"Downloading {filename}...")
    
    def progress_hook(block_num, block_size, total_size):
        downloaded = block_num * block_size
        if total_size > 0:
            percent = min(100, (downloaded * 100) // total_size)
            print(f"\\rProgress: {percent}% ({downloaded}/{total_size} bytes)", end='')
    
    urllib.request.urlretrieve(url, filename, reporthook=progress_hook)
    print("\\nDownload complete!")

def extract_ffmpeg(archive_path, extract_dir):
    """Extract FFmpeg from downloaded archive."""
    print(f"Extracting {archive_path}...")
    
    if archive_path.endswith('.zip'):
        with zipfile.ZipFile(archive_path, 'r') as zip_ref:
            zip_ref.extractall(extract_dir)
    elif archive_path.endswith('.tar.xz'):
        with tarfile.open(archive_path, 'r:xz') as tar_ref:
            tar_ref.extractall(extract_dir)
    
    print("Extraction complete!")

def find_ffmpeg_binary(extract_dir, platform_name):
    """Find the FFmpeg binary in the extracted directory."""
    if platform_name == 'Windows':
        # Look for ffmpeg.exe in subdirectories
        for root, dirs, files in os.walk(extract_dir):
            if 'ffmpeg.exe' in files:
                return os.path.join(root, 'ffmpeg.exe')
    else:
        # Look for ffmpeg binary in subdirectories  
        for root, dirs, files in os.walk(extract_dir):
            if 'ffmpeg' in files:
                ffmpeg_path = os.path.join(root, 'ffmpeg')
                # Make sure it's executable
                os.chmod(ffmpeg_path, 0o755)
                return ffmpeg_path
    
    return None

def setup_ffmpeg():
    """Download and setup FFmpeg if not available."""
    platform_name = get_platform()
    
    # Check if ffmpeg is already available
    try:
        subprocess.run(['ffmpeg', '-version'], capture_output=True, check=True)
        print("✅ FFmpeg is already installed and available!")
        return 'ffmpeg'
    except (subprocess.CalledProcessError, FileNotFoundError):
        print("FFmpeg not found in PATH. Setting up FFmpeg automatically...")
    
    # Create ffmpeg directory
    ffmpeg_dir = os.path.join(os.getcwd(), 'ffmpeg_portable')
    os.makedirs(ffmpeg_dir, exist_ok=True)
    
    # Check if we already have a portable version
    existing_ffmpeg = find_ffmpeg_binary(ffmpeg_dir, platform_name)
    if existing_ffmpeg and os.path.exists(existing_ffmpeg):
        print("✅ Using existing portable FFmpeg installation!")
        return existing_ffmpeg
    
    # Download FFmpeg
    if platform_name not in FFMPEG_URLS:
        raise RuntimeError(f"Unsupported platform: {platform_name}")
    
    url = FFMPEG_URLS[platform_name]
    archive_name = url.split('/')[-1]
    archive_path = os.path.join(ffmpeg_dir, archive_name)
    
    try:
        download_file(url, archive_path)
        extract_ffmpeg(archive_path, ffmpeg_dir)
        
        # Find the binary
        ffmpeg_binary = find_ffmpeg_binary(ffmpeg_dir, platform_name)
        
        if not ffmpeg_binary:
            raise RuntimeError("Could not find FFmpeg binary after extraction")
        
        # Test the binary
        subprocess.run([ffmpeg_binary, '-version'], capture_output=True, check=True)
        print("✅ FFmpeg setup complete!")
        
        # Clean up archive
        os.remove(archive_path)
        
        return ffmpeg_binary
        
    except Exception as e:
        print(f"❌ Error setting up FFmpeg: {e}")
        print("Please install FFmpeg manually from https://ffmpeg.org/download.html")
        sys.exit(1)

def is_video_file(filepath):
    """Check if file is a video based on MIME type."""
    mime_type, _ = mimetypes.guess_type(filepath)
    return mime_type is not None and mime_type.startswith('video')

def process_file(args):
    """Process a single video file with ffmpeg."""
    input_path, output_dir, ffmpeg_binary = args
    
    # Create output filename with .mp4 extension
    input_name = Path(input_path).stem
    output_path = os.path.join(output_dir, f"{input_name}.mp4")
    
    # Skip if output already exists
    if os.path.exists(output_path):
        print(f"Output already exists, skipping: {output_path}")
        return True
    
    # FFmpeg command for FERAL-compatible encoding
    cmd = [
        ffmpeg_binary, "-i", input_path,
        "-vf", "scale=256:256:flags=lanczos",  # Resize to 256x256 with high-quality scaling
        "-c:v", "libx264",                      # H.264 video codec
        "-pix_fmt", "yuv420p",                  # Standard pixel format
        "-crf", "25",                           # Constant rate factor (quality)
        "-preset", "superfast",                 # Encoding speed/quality balance
        "-an",                                  # Remove audio
        "-y",                                   # Overwrite output files
        output_path
    ]
    
    try:
        print(f"Processing: {os.path.basename(input_path)} -> {os.path.basename(output_path)}")
        result = subprocess.run(cmd, capture_output=True, text=True, check=True)
        print(f"✅ Successfully processed: {os.path.basename(output_path)}")
        return True
    except subprocess.CalledProcessError as e:
        print(f"❌ Error processing {input_path}: {e.stderr}")
        return False

def main():
    parser = argparse.ArgumentParser(description="Re-encode videos for FERAL processing with auto-FFmpeg setup")
    parser.add_argument("input_dir", help="Directory containing input videos")
    parser.add_argument("output_dir", help="Directory for re-encoded videos")
    parser.add_argument("--processes", "-p", type=int, default=4, 
                        help="Number of parallel processes (default: 4)")
    
    args = parser.parse_args()
    
    print("🎬 FERAL Video Re-encoding Script")
    print("=" * 50)
    
    # Validate input directory
    if not os.path.isdir(args.input_dir):
        print(f"❌ Error: Input directory does not exist: {args.input_dir}")
        sys.exit(1)
    video_paths = []
    for filename in os.listdir(args.input_dir):
        filepath = os.path.join(args.input_dir, filename)
        if os.path.isfile(filepath) and is_video_file(filepath):
            video_paths.append(filepath)
        else:
            print(f"Input directory must only have videos. Found not video: {filepath}")
            sys.exit(1)
    if not video_paths:
        print("❌ No video files found in input directory.")
        sys.exit(1)
    print(f"📁 Found {len(video_paths)} video files to process")
    
    # Create output directory
    out_dir = Path(args.output_dir)
    if out_dir.exists():
        if any(out_dir.iterdir()):
            print(f"Directory '{out_dir}' should be empty")
            sys.exit(1)
    else:
        out_dir.mkdir(parents=True)
    
    # Setup FFmpeg (download if needed)
    ffmpeg_binary = setup_ffmpeg()
    input_files = [(x, args.output_dir, ffmpeg_binary) for x in video_paths]
    
    print(f"Using this ffmpeg path: {ffmpeg_binary}")
    print(f"Using {args.processes} parallel processes")
    print(f"Output directory: {args.output_dir}")
    print("-" * 50)
    
    # Process files in parallel
    with Pool(processes=args.processes) as pool:
        results = pool.map(process_file, input_files)
    
    successful = sum(results)
    total = len(input_files)
    print("-" * 50)
    print(f"🎉 Processing complete: {successful}/{total} files successful")
    
    if successful < total:
        print(f"⚠️  {total - successful} files failed to process")
        sys.exit(1)
    else:
        print("✨ All videos successfully re-encoded for FERAL!")
        print(f"📂 Converted videos are in: {args.output_dir}")

if __name__ == "__main__":
    main()`;

            const copyToClipboard = async () => {
                try {
                    await navigator.clipboard.writeText(reencodingScript);
                    setCopySuccess(true);
                    setTimeout(() => setCopySuccess(false), 2000);
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            };

            const downloadScript = () => {
                const blob = new Blob([reencodingScript], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'reencode_videos.py';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
            <section id="video-preparation" className="bg-white p-8 rounded-lg shadow-md">
                <h2 className="text-3xl font-bold text-gray-900 mb-6">
                    Video Preparation
                  </h2>
                
                  {/* Quick-start checklist */}
                  <ol className="list-decimal list-inside space-y-4 text-gray-700 leading-relaxed mb-6">
                    <li>
                      Place <strong>all videos you want FERAL to use</strong> in a single
                      folder. That folder should contain <em>only</em> those videos.
                    </li>
                
                    <li>
                      Verify you have <strong>Python 3</strong> installed. Run&nbsp;
                      <code className="bg-gray-100 px-1 py-0.5 rounded">python --version</code> or 
                      <code className="bg-gray-100 px-1 py-0.5 rounded">python3 --version</code>.
                      It should print something like&nbsp;
                      <code className="bg-gray-100 px-1 py-0.5 rounded">Python&nbsp;3.9.10</code>.
                    </li>
                
                    <li>
                      Save the script below as&nbsp;
                      <code className="bg-gray-100 px-1 py-0.5 rounded">reencode_videos.py</code>.
                    </li>
                  </ol>

                {/* Collapsible Code Section */}
                <div className="mb-4">
                    <button
                        onClick={() => setIsCodeExpanded(!isCodeExpanded)}
                        className="w-full flex items-center justify-between p-4 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-lg transition-colors duration-200"
                    >
                        <span className="font-medium text-gray-800">
                            {isCodeExpanded ? '🔽 Hide Re-encoding Script' : '📝 Show Re-encoding Script'}
                        </span>
                        <svg
                            className={`w-5 h-5 transform transition-transform duration-200 ${isCodeExpanded ? 'rotate-180' : ''}`}
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    {isCodeExpanded && (
                        <div className="mt-4 border border-gray-300 rounded-lg overflow-hidden">
                            {/* Action Buttons */}
                            <div className="bg-gray-50 p-4 border-b border-gray-200 flex gap-3">
                                <button
                                    onClick={copyToClipboard}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${
                                        copySuccess 
                                            ? 'bg-green-500 text-white' 
                                            : 'bg-blue-500 hover:bg-blue-600 text-white'
                                    }`}
                                >
                                    {copySuccess ? (
                                        <>
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                            Copied!
                                        </>
                                    ) : (
                                        <>
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                            </svg>
                                            Copy Code
                                        </>
                                    )}
                                </button>
                                <button
                                    onClick={downloadScript}
                                    className="flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors duration-200"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    Download .py
                                </button>
                            </div>

                            {/* Code Display */}
                            <div className="bg-gray-900 p-4 text-sm font-mono overflow-x-auto text-green-400 max-h-96 overflow-y-auto">
                                <pre><code>{reencodingScript}</code></pre>
                            </div>
                        </div>
                    )}
                </div>

                <p className="text-gray-700 leading-relaxed mb-6">
                    4.&nbsp;Run&nbsp;
                    <code className="bg-gray-100 px-1 py-0.5 rounded">
                      python reencode_videos.py /path/to/video/folder /path/to/output/folder
                    </code>
                    .&nbsp;Add&nbsp;
                    <code className="bg-gray-100 px-1 py-0.5 rounded">--processes&nbsp; N </code>
                    &nbsp;if you want to change the number of parallel processes (default is 4).
                  </p>
                
                  {/* What & why */}
                  <h3 className="text-2xl font-semibold text-gray-900 mb-3">
                    What does this script do?
                  </h3>
                
                  <p className="text-gray-700 leading-relaxed mb-6">
                    During training, FERAL samples frames from anywhere in a video, so video encoding 
                    should support reading frames from the middle of the file.
                    Otherwise dataloading will throttle the GPU.
                    Unfortunately, many video encodings can’t do that efficiently. This script
                    re-encodes your footage with an encoding that supports this operation efficiently.
                  </p>
                
                  <p className="text-gray-700 leading-relaxed mb-6">
                    Our model currently expects <strong>256&nbsp;×&nbsp;256 px</strong> input,
                    so the script also resizes each video. That reduces file size and will speeds up
                    data transfer to the cloud.
                  </p>
                
                  <p className="text-gray-700 leading-relaxed">
                    The script uses <strong>FFmpeg</strong>. If FFmpeg isn’t installed, FERAL detects your OS,
                     downloads a portable build into
                    <code className="bg-gray-100 px-1 py-0.5 rounded">ffmpeg_portable</code>,
                    and reuses it next time.
                  </p>             
            </section>
        );
        };

        // LabelPreparationSection.jsx (or inline with your other sections)
        const LabelPreparationSection = () => (
            <section
            id="label-preparation"
            className="bg-white p-8 rounded-lg shadow-md"
            >
            <h2 className="text-3xl font-bold text-gray-900 mb-4">
                Label Preparation
            </h2>
                <p className="text-gray-700 leading-relaxed mb-4">
                    You need to structure your labels as a JSON file with a specific format. Here is an example of such file
                </p>

                <div className="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-x-auto">
                    <pre><code>{`{
  "class_names": {
    "0": "other",
    "1": "contact",
    "2": "attempt",
    "3": "flight",
    "4": "kicking",
    "5": "genital_contact",
    "6": "mating"
  },
  "labels": {
    "video_file_1.mp4": [0, 0, 1, 1, 2, 0, 0, 3, 3, 0],
    "video_file_2.mp4": [0, 0, 0, 4, 4, 5, 6, 6, 0, 0],
    "video_file_3.mp4": [0, 1, 1, 0, 0, 0, 2, 2, 3, 0]
  },
  "splits": {
    "train": [
      "video_file_1.mp4",
      "video_file_2.mp4"
    ],
    "val": [
      "video_file_3.mp4"
    ]
    "inference": [
      "video_file_4.mp4",
      "video_file_5.mp4",
      "video_file_6.mp4",
    ]
  }
}`}</code></pre>
                </div>

                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">Field Descriptions</h3>
                <div className="space-y-4">
                    <div>
                        <h4 className="text-lg font-semibold text-gray-800 mb-2">class_names</h4>
                        <p className="text-gray-700 leading-relaxed">
                            <strong>Required:</strong> Yes<br/>
                            <strong>Description:</strong> Maps numeric class IDs to human-readable class names<br/>
                            <strong>Format:</strong> <code className="bg-gray-100 px-2 py-1 rounded text-sm">{'{'}"class_id": "class_name"{'}'}</code><br/>
                            <strong>Note:</strong> Class IDs must be strings, even for numeric values (e.g., <code className="bg-gray-100 px-2 py-1 rounded text-sm">"0"</code>, <code className="bg-gray-100 px-2 py-1 rounded text-sm">"1"</code>). 
                            Class ids have to be consecutive integers from 0 to number_of_classes - 1. 
                            If your labels have a background class, assigned when no other meaningful class fits, call it "other", then metrics that average over classes will exclude it.
                        </p>
                    </div>

                    <div>
                        <h4 className="text-lg font-semibold text-gray-800 mb-2">labels</h4>
                        <p className="text-gray-700 leading-relaxed">
                            <strong>Required:</strong> Yes<br/>
                            <strong>Description:</strong> Contains frame-by-frame behavior labels for each video<br/>
                            <strong>Format:</strong> <code className="bg-gray-100 px-2 py-1 rounded text-sm">{'{'}"video_filename.mp4": [array_of_class_ids]{'}'}</code><br/>
                            <strong>Note:</strong> Each key should be a filename of the video (with extention). Each value in the dictionary is an integer array 
                            of the same length as number of frames in teh corresponding video. Each value in the array must correspond to a class ID defined in <code className="bg-gray-100 px-2 py-1 rounded text-sm">class_names</code>
                        </p>
                    </div>

                    <div>
                        <h4 className="text-lg font-semibold text-gray-800 mb-2">splits</h4>
                        <p className="text-gray-700 leading-relaxed">
                            <strong>Required:</strong> Yes<br/>
                            <strong>Description:</strong> Defines dataset partitions for training and validation<br/>
                            <strong>Fields:</strong><br/>
                            • <code className="bg-gray-100 px-2 py-1 rounded text-sm">train</code>: Array of video filenames for training<br/>
                            • <code className="bg-gray-100 px-2 py-1 rounded text-sm">val</code>: Array of video filenames for validation<br/>
                            • <code className="bg-gray-100 px-2 py-1 rounded text-sm">inference</code>: Array of video filenames for inference of the trained model<br/>
                            <strong>Note:</strong> Train and val filenames must have corresponding entries in the <code className="bg-gray-100 px-2 py-1 rounded text-sm">labels</code> section
                        </p>
                    </div>
                </div>

                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">Requirements</h3>
                <ul className="text-gray-700 leading-relaxed space-y-2">
                    <li><strong>Consistency:</strong> All video files referenced in train and val splits must have corresponding label data in <code className="bg-gray-100 px-2 py-1 rounded text-sm">labels</code></li>
                    <li><strong>Valid Class IDs:</strong> All integers in label arrays must exist as keys in <code className="bg-gray-100 px-2 py-1 rounded text-sm">class_names</code></li>
                    <li><strong>File Extensions:</strong> Video filenames should include the extension (e.g. .mp4)</li>
                    <li><strong>Array Length:</strong> Each label array must be the same length as the frame count of its video </li>
                </ul>

                <div className="mt-6 rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-blue-100/70 p-4">
                    <p className="text-blue-900 text-sm leading-relaxed">
                      <span className="mr-1" role="img" aria-label="Light bulb">💡</span>
                      <strong className="font-semibold">Tip:</strong>
                      {" "}
                      Not sure your JSON is valid? Try uploading it to our{" "}
                      <button
                        type="button"
                        onClick={() => handleNavClick("dataset-validator")}
                        className="inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium text-blue-700 bg-white/70 hover:bg-white shadow-sm ring-1 ring-inset ring-blue-300 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
                      >
                        Label Validation Tool
                      </button>
                    </p>
                  </div>

                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">🔄 Converting Existing Annotations to FERAL Format</h3>
                <p className="text-gray-700 leading-relaxed mb-4">
                    FERAL doesn’t come with a built-in annotation interface. Instead, it integrates directly with the BORIS behavioral-annotation software. 
                    If you use another tool, let us know and we’ll add support for it.
                </p>

                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                    <p className="text-yellow-800 font-medium">
                        ⚠️ <strong>Important:</strong> When converting annotations, ensure that video filenames in your annotation data 
                        match the re-encoded video files (with .mp4 extensions) rather than the original raw video file names.
                    </p>
                </div>

                <h4 className="text-lg font-semibold text-gray-800 mt-6 mb-3">BORIS to JSON Conversion Script</h4>
                <p className="text-gray-700 leading-relaxed mb-4">
                    Here's a conversion script for BORIS TSV files that produces the correct JSON structure:
                </p>

                <div className="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-x-auto">
                    <pre><code>{`# BORIS TSV -> FERAL JSON
# - Works with a single TSV path or a folder containing *.tsv
# - START/STOP rows create half-open frame intervals [START, STOP)
# - class_names are derived from the union of behaviors found across all TSVs
# - Video name is taken from "Media file path" (fallback: <tsv_stem>.mp4)
# - Saves "feral_behavioral_labels.json" in the input folder (or next to the TSV if single file)

import json, re, math
from pathlib import Path

# ---------------------- settings ----------------------
INPUT_PATH = "/mnt/data/ob088-track-9.tsv"  # file OR folder
DEFAULT_FPS = 30.0
SPLIT_STRATEGY = "roundrobin"               # "roundrobin" | "all_train"
ROUNDROBIN_RATIO = 0.8                      # 80% train / 20% val when using roundrobin
# ------------------------------------------------------

def _norm_name(s: str) -> str:
    return re.sub(r"\s+", "_", str(s).strip().lower())

def _safe_float(x, default=None):
    try:
        return float(x)
    except Exception:
        return default

def _read_boris_records(tsv_path: str):
    """Return (header_cols, records[list of dicts]). Robust to spacer lines."""
    p = Path(tsv_path)
    with open(p, "r", encoding="utf-8", errors="ignore") as f:
        lines = f.readlines()

    header_idx, header_cols = None, None
    for i, raw in enumerate(lines):
        s = raw.replace("\u00A0", " ").strip("\r\n")
        if not s:
            continue
        parts = s.split("\t")
        joined_lower = "\t".join([x.strip().lower() for x in parts])
        if (joined_lower.startswith("time")
            and "media file path" in joined_lower
            and "total length" in joined_lower
            and "fps" in joined_lower
            and "status" in joined_lower):
            header_idx = i
            header_cols = [c.strip() for c in parts]
            break

    if header_idx is not None:
        rows = []
        for raw in lines[header_idx+1:]:
            if not raw.strip():
                continue
            parts = [c.strip() for c in raw.strip("\r\n").split("\t")]
            if len(parts) < len(header_cols):
                parts += [""] * (len(header_cols) - len(parts))
            elif len(parts) > len(header_cols):
                parts = parts[:len(header_cols)]
            rows.append(parts)
        return header_cols, [dict(zip(header_cols, r)) for r in rows]

    # headerless fallback: assume standard BORIS order
    fallback = ["Time","Media file path","Total length","FPS","Subject","Behavior","Behavioral category","Comment","Status"]
    rows = []
    for raw in lines:
        if not raw.strip():
            continue
        parts = [c.strip() for c in raw.strip("\r\n").split("\t")]
        t = _safe_float(parts[0] if parts else None, None)
        if t is None:
            continue
        if len(parts) < len(fallback):
            parts += [""] * (len(fallback) - len(parts))
        elif len(parts) > len(fallback):
            parts = parts[:len(fallback)]
        rows.append(parts)
    return fallback, [dict(zip(fallback, r)) for r in rows]

def _find_col(header_cols, name):
    name_l = name.strip().lower()
    for c in header_cols:
        if c.strip().lower() == name_l:
            return c
    for c in header_cols:
        if name_l in c.strip().lower():
            return c
    return None

def _video_name(records, col_path, fallback):
    # Prefer basename of media path; otherwise <tsv_stem>.mp4; ensure extension present
    media_path = None
    for rec in records:
        mp = rec.get(col_path, "").strip() if col_path else ""
        if mp:
            media_path = mp
            break
    if media_path:
        name = Path(media_path).name
    else:
        name = f"{fallback}.mp4"
    if "." not in Path(name).name:
        name = f"{name}.mp4"
    return name

def _fps_and_duration(records, col_fps, col_total_len, col_time):
    fps = None
    total_len = None
    for rec in records:
        if fps is None:
            fps = _safe_float(rec.get(col_fps), None) if col_fps else None
        if total_len is None:
            total_len = _safe_float(rec.get(col_total_len), None) if col_total_len else None
        if fps is not None and total_len is not None:
            break
    if fps is None or not math.isfinite(fps) or fps <= 0:
        fps = DEFAULT_FPS
    if total_len is None or not math.isfinite(total_len) or total_len <= 0:
        # fallback to max of time
        mx = 0.0
        for rec in records:
            t = _safe_float(rec.get(col_time), None) if col_time else None
            if t is not None and t > mx:
                mx = t
        total_len = mx
    return fps, total_len

def _labels_from_records(records, fps, total_frames, col_time, col_beh, col_status, beh_to_id):
    labels = [0] * total_frames
    active = {}
    def to_frame(t):
        if t is None:
            return None
        f = int(round(t * fps))
        return max(0, min(f, total_frames))

    for rec in records:
        t = _safe_float(rec.get(col_time), None)
        beh_raw = str(rec.get(col_beh, "")).strip() if col_beh else ""
        status = str(rec.get(col_status, "")).strip().upper() if col_status else ""
        if not beh_raw or t is None:
            continue

        beh = _norm_name(beh_raw)
        cid = beh_to_id.get(beh, 0)
        f = to_frame(t)
        if f is None:
            continue

        if status == "START":
            active[beh] = f
        elif status == "STOP":
            if beh in active:
                s = active.pop(beh)
                a, b = min(s, f), max(s, f)
                for ff in range(a, min(b, total_frames)):
                    labels[ff] = cid
        else:
            # treat unknown/POINT as single-frame
            ff = min(max(0, f), max(0, total_frames - 1))
            if 0 <= ff < total_frames:
                labels[ff] = cid
    return labels

def _collect_all_behaviors(tsv_paths):
    beh = set()
    for tsv in tsv_paths:
        header, recs = _read_boris_records(tsv)
        col_beh = _find_col(header, "Behavior")
        if not col_beh:
            continue
        for r in recs:
            b = str(r.get(col_beh, "")).strip()
            if b:
                beh.add(_norm_name(b))
    return sorted(beh)

def convert_path_to_feral(input_path):
    p = Path(input_path)
    if p.is_dir():
        tsvs = sorted(p.glob("*.tsv"))
        out_json_path = p / "feral_behavioral_labels.json"
    else:
        tsvs = [p]
        out_json_path = p.with_name("feral_behavioral_labels.json")

    if not tsvs:
        raise FileNotFoundError("No TSV files found.")

    # Build class set from union of behaviors across all TSVs
    observed = _collect_all_behaviors(tsvs)
    beh_to_id = {"other": 0}
    next_id = 1
    for b in observed:
        if b not in beh_to_id:
            beh_to_id[b] = next_id
            next_id += 1
    class_names = {str(v): k for k, v in beh_to_id.items()}

    labels = {}
    video_files = []

    for tsv in tsvs:
        header, recs = _read_boris_records(str(tsv))

        col_time   = _find_col(header, "Time")
        col_path   = _find_col(header, "Media file path")
        col_tlen   = _find_col(header, "Total length")
        col_fps    = _find_col(header, "FPS")
        col_beh    = _find_col(header, "Behavior")
        col_status = _find_col(header, "Status")

        missing = [n for n,c in {
            "Time": col_time, "Media file path": col_path, "Total length": col_tlen,
            "FPS": col_fps, "Behavior": col_beh, "Status": col_status
        }.items() if c is None]
        if missing:
            raise KeyError(f"{tsv.name}: missing columns: {missing} (found: {header})")

        fps, total_len = _fps_and_duration(recs, col_fps, col_tlen, col_time)
        total_frames = int(max(0, round(total_len * fps)))
        vname = _video_name(recs, col_path, tsv.stem)
        video_files.append(vname)

        labels[vname] = _labels_from_records(
            recs, fps, total_frames, col_time, col_beh, col_status, beh_to_id
        )

    # Splits
    splits = {"train": [], "val": [], "inference": []}
    if SPLIT_STRATEGY == "all_train":
        splits["train"] = video_files
    else:
        # simple round-robin 80/20
        cutoff = max(1, int(round(len(video_files) * ROUNDROBIN_RATIO)))
        splits["train"] = video_files[:cutoff]
        splits["val"] = video_files[cutoff:]

    out = {"class_names": class_names, "labels": labels, "splits": splits}

    with open(out_json_path, "w", encoding="utf-8") as f:
        json.dump(out, f, indent=2)

    print(f"Saved: {out_json_path}")
    print(f"Videos: {len(video_files)} | Classes (incl. 'other'): {len(class_names)}")
    return out_json_path, out

# Run:
# convert_path_to_feral(INPUT_PATH)
`}</code></pre>
                </div>

                <div className="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
                    <p className="text-yellow-800 font-medium">
                        ⚠️ <strong>Note:</strong> This script assumes your BORIS TSV files contain columns for 'Media duration (s)', 'FPS', 'Behavior', 'Behavior type', and 'Time'. 
                        Make sure the files contain these columns.
                    </p>
                </div>

            </section>
        );
  

        const RunningFeralSection = ({ handleNavClick }) => {
  const [isTransferExpanded, setIsTransferExpanded] = React.useState(false);

  return (
    <section id="running-feral" className="bg-white p-8 rounded-lg shadow-md">
      <h2 className="text-3xl font-bold text-gray-900 mb-6">
        Running FERAL
      </h2>

      {/* Option A: Google Colab */}
      <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">
        Option A: Google Colab (Recommended)
      </h3>
      <p className="text-gray-700 leading-relaxed mb-3">
        The easiest way to run FERAL is directly in your browser using our
        <strong> interactive Google Colab notebook</strong>. This notebook is
        <strong> fully self-contained</strong> and provides end-to-end
        instructions for the entire workflow—from video preparation to model
        training and evaluation.
      </p>
      <ul className="list-disc list-inside text-gray-700 mb-4">
        <li>💻 Zero setup — no installation or dependencies required</li>
        <li>⚡ Use an <code>A100</code> or <code>L4</code> GPU for best performance</li>
        <li>🎓 Colab Pro is free for academics with an institutional email</li>
        <li>☁️ Data can stay in your Google Drive</li>
      </ul>

      <a
        href="https://colab.research.google.com/drive/1bJkHewHpEU7iJT3fIHd0YNrQJ9hkSEdu?usp=sharing"
        target="_blank"
        rel="noopener noreferrer"
        className="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition"
      >
        🚀 Launch FERAL in Colab
      </a>

      <p className="text-sm text-gray-600 mt-3">
        This method is ideal for most users and replicates the same results as
        local or cloud-GPU setups.
      </p>

      {/* Option B: Local */}
      <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-3">
        Option B: Local Installation
      </h3>
      <p>
        Make sure that you have installed:
        <br />  - Python 3.10
        <br />  - PyTorch 2.4.0
        <br />  - CUDA 12.4
        <br />
        You can try newer/older versions, but we don't guarantee compatibility.
        Ensure that you can access your video folder and the JSON file containing
        labels.
      </p>

      {/* Option C: RunPod */}
      <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-3">
        Option C: Cloud Server on RunPod
      </h3>
      <p>
        Prefer a dedicated GPU server? FERAL can run on
        <a
          href="https://www.runpod.io"
          className="text-blue-600 hover:underline ml-1"
          rel="noopener noreferrer"
        >
          RunPod
        </a>.
        This option gives you full control of the environment and long-term
        storage for large datasets.
      </p>

      <ol className="list-decimal list-inside space-y-2 mt-3 text-gray-700">
        <li>
          Get a RunPod account with about $10 credit, or contact us for access.
        </li>
        <li>
          Go to 
          <a
            href="https://console.runpod.io/deploy?gpu=H100%20SXM&count=1&template=runpod-torch-v240"
            className="text-blue-600 hover:underline"
            rel="noopener noreferrer"
          >
            this RunPod deploy link
          </a>{" "}
          and enable <em>SSH Terminal Access</em> and <em>Start Jupyter Notebook</em>.
          Increase disk size if needed.
        </li>
        <li>
          Go to 
          <a
            href="https://console.runpod.io/pods"
            className="text-blue-600 hover:underline"
            rel="noopener noreferrer"
          >
            My Pods
          </a>
          , wait for startup, then click <em>Connect → Jupyter Lab :8888</em>.
        </li>
        <li>
          Once in Jupyter Lab, open <em>Terminal</em> and run:{" "}
          <code className="bg-gray-200 px-1 rounded">
            apt update && apt install -y unzip
          </code>
        </li>
        <li>
          Transfer your videos and labels to the server (see transfer options below).
        </li>
      </ol>

      {/* Expandable transfer options */}
      <button
        onClick={() => setIsTransferExpanded(!isTransferExpanded)}
        className="w-full flex items-center justify-between p-4 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-lg transition-colors duration-200 mt-4"
      >
        <span className="font-medium text-gray-800">
          {isTransferExpanded
            ? "🔽 Hide Video Transfer Options"
            : "📤 Show Video Transfer Options"}
        </span>
        <svg
          className={`w-5 h-5 transform transition-transform duration-200 ${
            isTransferExpanded ? "rotate-180" : ""
          }`}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M19 9l-7 7-7-7"
          />
        </svg>
      </button>

      {isTransferExpanded && (
        <div className="mt-4 border border-gray-300 rounded-lg overflow-hidden p-4">
          <p className="text-gray-700">
            We advise compressing your video folder into a .zip archive before
            transfer. You can then use Jupyter Lab upload, SSH, or bashupload.com.
            <br />
            SSH is fastest; drag and drop is simplest.
          </p>
        </div>
      )}

      {/* Step 2: Prepare your data */}
      <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-3">
        1. Prepare your data
      </h3>

      <p className="text-gray-700 leading-relaxed mb-4">
        Before starting training, you must have:
      </p>

      <ul className="list-disc list-inside text-gray-700 mb-4">
        <li>
          A folder containing all your{" "}
          <strong>re-encoded videos</strong> (256×256 .mp4 files from the
          Video Preparation step).
        </li>
        <li>
          A single <code className="bg-gray-100 px-1 py-0.5 rounded">.json</code>{" "}
          file with your frame-by-frame annotations in FERAL format
          (class_names / labels / splits).
        </li>
      </ul>

      <p className="text-gray-700 leading-relaxed mb-4">
        Place the JSON file <strong>in the same directory</strong> where the
        videos live, so FERAL can find both the data and the labels.
      </p>

      <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
        <p className="text-yellow-900 text-sm leading-relaxed">
          ✅ You can confirm your annotation JSON is valid by using the
          built-in dataset validator.
        </p>

        <button
          onClick={() => handleNavClick("dataset-validator")}
          className="mt-4 inline-block w-full sm:w-auto text-center bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-5 rounded-lg shadow-md transition duration-200"
        >
          🔍 Validate my dataset
        </button>
      </div>

      {/* Step 3: Start training */}
      <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-3">
        2. Start training (Manual or RunPod/Local)
      </h3>

      <p className="text-gray-700 leading-relaxed">
        If you’re not using Colab, clone the repository and install dependencies:
      </p>

      <pre className="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-x-auto">
        git clone https://github.com/Skovorp/feral.git
        <br />
        cd feral
        <br />
        pip install -r requirements.txt
      </pre>

      <p className="text-gray-700 leading-relaxed">
        To start a training run:
      </p>

      <pre className="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-x-auto">
        python run.py path_to_videos path_to_labels.json
      </pre>

      <p className="mt-3 text-gray-700 leading-relaxed">
        Training metrics are logged to Weights &amp; Biases. You’ll be prompted to either
        log to your own project (using a{" "}
        <a
          href="https://wandb.ai/authorize"
          className="text-blue-600 hover:underline"
          rel="noopener noreferrer"
        >
          W&amp;B API key
        </a>
        ) or the public FERAL project.
      </p>

      {/* Step 4: Track performance */}
      <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-3">
        3. Track performance
      </h3>

      <p className="text-gray-700 leading-relaxed">
        In Weights &amp; Biases, monitor:
        <br />
        1. <strong>val_raster_plot / ema_val_raster_plot</strong> – raster of model
        predictions across validation videos.
        <br />
        2. <strong>ema_val_frame_level_map</strong> – main metric (Average Precision
        across classes, frame-level). &lt;0.5 is weak, &gt;0.9 is strong.
        <br />
        3. <strong>train_map / val_map / ema_val_map</strong> – batch-level
        Average Precision.
        <br />
        4. <strong>train loss / val loss</strong> – should steadily go down. If
        train loss drops and val loss rises, you're overfitting.
      </p>

      <h4 className="text-lg font-semibold text-gray-800 mt-6 mb-2">
        What's EMA?
      </h4>
      <p className="text-gray-700 leading-relaxed">
        EMA (Exponential Moving Average) keeps a smoothed copy of the model
        weights:
        <code className="bg-gray-100 px-1 py-0.5 rounded ml-1">
          ema = 0.999 × ema + 0.001 × weights
        </code>
        . FERAL saves outputs from both the main model and the EMA model so you
        can choose whichever performs better.
      </p>

      {/* Step 5: Final results */}
      <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-3">
        4. Get final results
      </h3>

      <p className="text-gray-700 leading-relaxed">
        At the end of training you'll get a file in your{" "}
        <code className="bg-gray-100 px-1 py-0.5 rounded font-mono">answers</code>{" "}
        folder named something like{" "}
        <code className="bg-gray-100 px-1 py-0.5 rounded font-mono">
          _inference_&#123;run_name&#125;_&#123;%Y-%m-%d_%H-%M-%S&#125;.json
        </code>
        . That JSON contains predicted behaviors for every frame of every
        inference video you provided.
      </p>

    </section>
  );
};
        const ColabSection = () => (
  <section id="colab" className="bg-white p-8 rounded-lg shadow-md">
    <h2 className="text-3xl font-bold text-gray-900 mb-4">Run FERAL on Google Colab</h2>
    <p className="text-gray-700 leading-relaxed mb-4">
      The easiest way to run FERAL is directly in your browser using our
      <strong> interactive Google Colab notebook</strong> — no installation,
      drivers, or setup required.
    </p>

    <ul className="list-disc list-inside text-gray-700 mb-4">
      <li>💻 <strong>Zero-setup</strong>: open, connect, and run immediately.</li>
      <li>⚡ <strong>GPU accelerated</strong>: select an <code>A100</code> or <code>L4</code> GPU for best performance.</li>
      <li>🎓 <strong>Free for academics</strong>: Colab Pro can be requested free of charge with an institutional email.</li>
      <li>☁️ Data stays in your Google Drive; no external uploads needed.</li>
    </ul>

    <div className="mt-6">
      <a
        href="https://colab.research.google.com/drive/1bJkHewHpEU7iJT3fIHd0YNrQJ9hkSEdu?usp=sharing"

        target="_blank"
        rel="noopener noreferrer"
        className="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition"
      >
        🚀 Launch in Colab
      </a>
    </div>

    <p className="text-gray-600 mt-6 text-sm">
      For most users this is the recommended method — training runs smoothly even
      on modest datasets and reproduces identical results to local or cloud-GPU setups.
    </p>
  </section>
);

const RunPodSection = () => (
  <section id="runpod" className="bg-white p-8 rounded-lg shadow-md">
    <h2 className="text-3xl font-bold text-gray-900 mb-4">Run FERAL on RunPod</h2>
    <p className="text-gray-700 leading-relaxed mb-4">
      Prefer a dedicated cloud GPU? FERAL supports full training on&nbsp;
      <a href="https://www.runpod.io" className="text-blue-600 hover:underline">RunPod</a>.
      Deployment takes under 5 minutes using our ready-made template.
    </p>

    <ul className="list-disc list-inside text-gray-700 mb-4">
      <li>🔧 Full control over environment and storage.</li>
      <li>🚀 Access to H100 / A100 GPUs for large-scale datasets.</li>
      <li>💳 Pay-as-you-go billing — shut down anytime.</li>
    </ul>

    <p className="text-gray-600">
      See the detailed step-by-step guide in the <strong>RunPod</strong> section
      of the documentation if you prefer this route.
    </p>
  </section>
);

        const DatasetValidatorSection = () => {
            const [file, setFile] = useState(null);
            const [validationResult, setValidationResult] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleFileChange = (event) => {
                setFile(event.target.files[0]);
                setValidationResult(null);
                setError(null);
            };

            const validateFeralDataset = (data) => {
                const issues = [];
                const warnings = [];
                let isValid = true;

                // Check required top-level keys
                const requiredKeys = ['class_names', 'labels', 'splits'];
                for (const key of requiredKeys) {
                    if (!(key in data)) {
                        issues.push(`Missing required key: "${key}"`);
                        isValid = false;
                    }
                }

                if (!isValid) {
                    return { isValid: false, issues, warnings, metadata: null };
                }


                // Validate class_names
                if (typeof data.class_names !== 'object' || Array.isArray(data.class_names)) {
                    issues.push('class_names must be an object');
                    isValid = false;
                } else {
                    const classIds = Object.keys(data.class_names);
                    if (classIds.length === 0) {
                        issues.push('class_names cannot be empty');
                        isValid = false;
                    } else {
                        const expectedKeys = new Set();
                        for (let i = 0; i < classIds.length; i++) {
                            expectedKeys.add(String(i));
                        }
                
                        const actualKeys = new Set(classIds);
                        for (const key of expectedKeys) {
                            if (!actualKeys.has(key)) {
                                issues.push(`class_names must have consecutive numeric keys as strings starting from "0". Missing key: "${key}"`);
                                isValid = false;
                                break;
                            }
                        }
                
                        const values = Object.values(data.class_names);
                        const uniqueValues = new Set(values);
                        if (values.length !== uniqueValues.size) {
                            issues.push('class_names values must be unique');
                            isValid = false;
                        }

                        if (!Object.values(data.class_names).includes('other')) {
                            warnings.push(`Class "other" isn't present in class names. Performance metrics will be averaged across all classes`);
                        }
                    }
                }

                // Validate labels structure
                if (typeof data.labels !== 'object' || Array.isArray(data.labels)) {
                    issues.push('labels must be an object');
                    isValid = false;
                } else {
                    const videoFiles = Object.keys(data.labels);
                    if (videoFiles.length === 0) {
                        issues.push('labels cannot be empty');
                        isValid = false;
                    }
                }

                // Validate splits structure
                if (typeof data.splits !== 'object' || Array.isArray(data.splits)) {
                    issues.push('splits must be an object');
                    isValid = false;
                } else {
                    const allowedKeys = new Set(['train', 'val', 'inference']);
                    for (const key in data.splits) {
                        if (!allowedKeys.has(key)) {
                            issues.push(`splits must have keys "train", "val" and maybe "inference". Found unexpected: ${key}`);
                            isValid = false;
                        }
                    }
                    if (!Array.isArray(data.splits.train)) {
                        issues.push('splits.train must be an array');
                        isValid = false;
                    }
                    if (!Array.isArray(data.splits.val)) {
                        issues.push('splits.val must be an array');
                        isValid = false;
                    }
                    if ('inference' in data.splits && !Array.isArray(data.splits.inference)) {
                        issues.push('splits.inference must be an array');
                        isValid = false;
                    }                    
                }

                if (!isValid) {
                    return { isValid: false, issues, warnings, metadata: null };
                }

                // Detailed validation and metadata extraction
                const classIds = Object.keys(data.class_names);
                const videoFiles = Object.keys(data.labels);
                const trainFiles = data.splits.train || [];
                const valFiles = data.splits.val || [];
                const inferenceFiles = data.splits.inference || [];
                const allSplitFiles = [...trainFiles, ...valFiles];

                // Check consistency between labels and splits
                const missingInLabels = allSplitFiles.filter(f => !videoFiles.includes(f));
                const missingInSplits = videoFiles.filter(f => !allSplitFiles.includes(f));
                
                if (missingInLabels.length > 0) {
                    issues.push(`Files in splits but missing in labels: ${missingInLabels.join(', ')}`);
                }
                if (missingInSplits.length > 0) {
                    warnings.push(`Files in labels but missing in splits: ${missingInSplits.join(', ')}`);
                }

                // Helper to find duplicates
                function findDuplicates(arr) {
                    const seen = new Set();
                    const duplicates = new Set();
                    for (const item of arr) {
                        if (seen.has(item)) {
                            duplicates.add(item);
                        }
                        seen.add(item);
                    }
                    return [...duplicates];
                }

                const dupInSplits = findDuplicates(allSplitFiles);
                if (dupInSplits.length > 0) {
                    issues.push(`Duplicate files found in train/val splits: ${dupInSplits.join(', ')}`);
                }

                const dupInInference = findDuplicates(inferenceFiles);
                if (dupInInference.length > 0) {
                    issues.push(`Duplicate files found in inference split: ${dupInInference.join(', ')}`);
                }

                // Check for duplicate files in splits
                const duplicates = trainFiles.filter(f => valFiles.includes(f));
                if (duplicates.length > 0) {
                    issues.push(`Files appear in both train and val splits: ${duplicates.join(', ')}`);
                }

                // Analyze labels for each video
                const videoMetadata = {};
                const behaviorCounts = {};
                const classCounts = {};

                // Initialize behavior counts
                Object.values(data.class_names).forEach(behavior => {
                    behaviorCounts[behavior] = 0;
                });

                // Initialize class counts
                classIds.forEach(id => {
                    classCounts[id] = 0;
                });

                for (const [videoFile, labelArray] of Object.entries(data.labels)) {
                    if (!Array.isArray(labelArray)) {
                        issues.push(`Labels for "${videoFile}" must be an array`);
                        continue;
                    }

                    const frameCount = labelArray.length;
                    const videoBehaviorCounts = {};
                    const videoClassCounts = {};

                    // Initialize counts for this video
                    Object.values(data.class_names).forEach(behavior => {
                        videoBehaviorCounts[behavior] = 0;
                    });
                    classIds.forEach(id => {
                        videoClassCounts[id] = 0;
                    });

                    // Count occurrences
                    labelArray.forEach(label => {
                        const labelStr = String(label);
                        if (!classIds.includes(labelStr)) {
                            issues.push(`Invalid class ID "${label}" in video "${videoFile}"`);
                            return;
                        }
                        
                        const behaviorName = data.class_names[labelStr];
                        videoBehaviorCounts[behaviorName]++;
                        videoClassCounts[labelStr]++;
                        behaviorCounts[behaviorName]++;
                        classCounts[labelStr]++;
                    });

                    videoMetadata[videoFile] = {
                        frameCount,
                        behaviorCounts: videoBehaviorCounts,
                        classIdCounts: videoClassCounts,
                        split: trainFiles.includes(videoFile) ? 'train' : 
                               valFiles.includes(videoFile) ? 'val' : 'unassigned'
                    };
                }

                const totalClassFrames = Object.values(behaviorCounts).reduce((sum, count) => sum + count, 0);

                for (const [className, count] of Object.entries(behaviorCounts)) {
                    const percent = (count / totalClassFrames) * 100;
                    if (percent < 0.5) {
                        warnings.push(`Class "${className}" is rare (${percent.toFixed(2)}% of frames). Consider adding more labels for this class or joining it with a similar class`);
                    }
                }

                const metadata = {
                    trainVideos: trainFiles.length,
                    valVideos: valFiles.length,
                    inferenceVideos: inferenceFiles.length,
                    totalClasses: classIds.length,
                    classNames: data.class_names,
                    totalFrames: Object.values(videoMetadata).reduce((sum, meta) => sum + meta.frameCount, 0),
                    behaviorCounts,
                    classCounts,
                    videoMetadata
                };

                return {
                    isValid: issues.length === 0,
                    issues,
                    warnings,
                    metadata
                };
            };

            const validateDataset = async () => {
                if (!file) {
                    setError("Please select a file to validate.");
                    return;
                }

                setIsLoading(true);
                setError(null);
                setValidationResult(null);

                try {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const fileContent = e.target.result;
                        let result = {};

                        if (file.name.endsWith('.json')) {
                            try {
                                const data = JSON.parse(fileContent);
                                const validation = validateFeralDataset(data);
                                
                                result = {
                                    status: validation.isValid ? 'success' : 'error',
                                    message: validation.isValid ? 
                                        `JSON file "${file.name}" is valid!` : 
                                        `JSON file "${file.name}" has validation errors.`,
                                    details: validation.isValid ? 
                                        'All required fields are present and properly formatted.' : 
                                        'Please fix the issues listed below.',
                                    issues: validation.issues,
                                    warnings: validation.warnings,
                                    metadata: validation.metadata
                                };
                            } catch (parseError) {
                                result = {
                                    status: 'error',
                                    message: `Invalid JSON format for file "${file.name}".`,
                                    details: parseError.message,
                                    issues: ['JSON parsing error'],
                                    warnings: [],
                                    metadata: null
                                };
                            }
                        } else {
                            result = {
                                status: 'info',
                                message: `File "${file.name}" is not a JSON file.`,
                                details: 'Please upload a JSON file for FERAL dataset validation.',
                                issues: ['Wrong file format'],
                                warnings: [],
                                metadata: null
                            };
                        }
                        setValidationResult(result);
                        setIsLoading(false);
                    };
                    reader.readAsText(file);
                } catch (err) {
                    setError(`An unexpected error occurred: ${err.message}`);
                    setIsLoading(false);
                }
            };

            return (
                <section id="dataset-validator" className="bg-white p-8 rounded-lg shadow-md">
                    <h2 className="text-3xl font-bold text-gray-900 mb-4">Dataset Validator</h2>
                    <p className="text-gray-700 leading-relaxed mb-6">
                        Upload your FERAL dataset JSON file to validate its structure and get detailed analysis including 
                        frame counts, behavior distributions, and format compliance.
                    </p>

                    <div className="mb-6">
                        <label htmlFor="file-upload" className="block text-sm font-medium text-gray-700 mb-2">
                            Upload your dataset JSON file:
                        </label>
                        <input
                            id="file-upload"
                            type="file"
                            accept=".json"
                            onChange={handleFileChange}
                            className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-200 file:text-gray-700 hover:file:bg-gray-300"
                        />
                        {file && (
                            <p className="mt-2 text-sm text-gray-600">Selected file: <span className="font-medium">{file.name}</span></p>
                        )}
                    </div>

                    <button
                        onClick={validateDataset}
                        disabled={!file || isLoading}
                        className={`bg-gray-900 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1 ${(!file || isLoading) ? 'opacity-50 cursor-not-allowed' : ''}`}
                    >
                        {isLoading ? 'Validating...' : 'Validate Dataset'}
                    </button>

                    {error && (
                        <div className="mt-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md" role="alert">
                            <p className="font-bold">Error:</p>
                            <p>{error}</p>
                        </div>
                    )}

                    {validationResult && (
                        <div className="mt-6 space-y-6">
                            {/* Main validation result */}
                            <div className={`p-6 rounded-lg shadow-inner ${validationResult.status === 'success' ? 'bg-green-50 border-green-400' : validationResult.status === 'error' ? 'bg-red-50 border-red-400' : 'bg-gray-50 border-gray-400'} border-l-4`}>
                                <h3 className={`text-xl font-bold mb-2 ${validationResult.status === 'success' ? 'text-green-700' : validationResult.status === 'error' ? 'text-red-700' : 'text-gray-700'}`}>
                                    {validationResult.status === 'success' ? '✅ Validation Successful!' : 
                                     validationResult.status === 'error' ? '❌ Validation Failed' : 'ℹ️ Information'}
                                </h3>
                                <p className="text-gray-800 mb-2">{validationResult.message}</p>
                                {validationResult.details && <p className="text-gray-600 text-sm">{validationResult.details}</p>}
                            </div>

                            {/* Issues and Warnings */}
                            {(validationResult.issues?.length > 0 || validationResult.warnings?.length > 0) && (
                                <div className="space-y-4">
                                    {validationResult.issues?.length > 0 && (
                                        <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                                            <h4 className="font-semibold text-red-700 mb-2">❌ Issues Found:</h4>
                                            <ul className="list-disc list-inside text-red-600 space-y-1">
                                                {validationResult.issues.map((issue, index) => (
                                                    <li key={index}>{issue}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}
                                    
                                    {validationResult.warnings?.length > 0 && (
                                        <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                            <h4 className="font-semibold text-yellow-700 mb-2">⚠️ Warnings:</h4>
                                            <ul className="list-disc list-inside text-yellow-600 space-y-1">
                                                {validationResult.warnings.map((warning, index) => (
                                                    <li key={index}>{warning}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Dataset Metadata */}
                            {validationResult.metadata && validationResult.status === 'success' && (
                                <div className="space-y-6">
                                    <h3 className="text-xl font-bold text-gray-900">📊 Dataset Analysis</h3>
                                    
                                    {/* Summary Statistics */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                                            <h4 className="font-semibold text-green-700">Training Videos</h4>
                                            <p className="text-2xl font-bold text-green-800">{validationResult.metadata.trainVideos}</p>
                                        </div>
                                        <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                            <h4 className="font-semibold text-purple-700">Validation Videos</h4>
                                            <p className="text-2xl font-bold text-purple-800">{validationResult.metadata.valVideos}</p>
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                            <h4 className="font-semibold text-blue-700">Inference Videos</h4>
                                            <p className="text-2xl font-bold text-blue-800">{validationResult.metadata.inferenceVideos}</p>
                                        </div>
                                        <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                            <h4 className="font-semibold text-orange-700">Total Labeled Frames</h4>
                                            <p className="text-2xl font-bold text-orange-800">{validationResult.metadata.totalFrames.toLocaleString()}</p>
                                        </div>
                                    </div>

                                    {/* Class Distribution */}
                                    <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                        <h4 className="font-semibold text-gray-700 mb-4">🎯 Behavior Distribution</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {Object.entries(validationResult.metadata.behaviorCounts).map(([behavior, count]) => (
                                                <div key={behavior} className="flex justify-between items-center p-3 bg-white rounded border">
                                                    <span className="font-medium text-gray-700 capitalize">{behavior}</span>
                                                    <span className="text-lg font-bold text-gray-900">{count.toLocaleString()}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Per-Video Analysis */}
                                    <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                        <h4 className="font-semibold text-gray-700 mb-4">📹 Per-Video Analysis</h4>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm text-left text-gray-500 border border-gray-200">
                                                <thead className="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th className="px-4 py-2 border-b">Video File</th>
                                                        <th className="px-4 py-2 border-b">Split</th>
                                                        <th className="px-4 py-2 border-b">Frames</th>
                                                        <th className="px-4 py-2 border-b">Behaviors</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {Object.entries(validationResult.metadata.videoMetadata).map(([videoFile, meta]) => (
                                                        <tr key={videoFile} className="bg-white border-b hover:bg-gray-50">
                                                            <td className="px-4 py-2 font-medium text-gray-900">{videoFile}</td>
                                                            <td className="px-4 py-2">
                                                                <span className={`px-2 py-1 text-xs rounded-full ${meta.split === 'train' ? 'bg-green-100 text-green-800' : meta.split === 'val' ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'}`}>
                                                                    {meta.split}
                                                                </span>
                                                            </td>
                                                            <td className="px-4 py-2">{meta.frameCount.toLocaleString()}</td>
                                                            <td className="px-4 py-2">
                                                                <div className="flex flex-wrap gap-1">
                                                                    {Object.entries(meta.behaviorCounts)
                                                                        .filter(([_, count]) => count > 0)
                                                                        .map(([behavior, count]) => (
                                                                            <span key={behavior} className="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">
                                                                                {behavior}: {count}
                                                                            </span>
                                                                        ))
                                                                    }
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </section>
            );
        };

        const ExamplesSection = () => (
  <section id="examples" className="bg-white p-8 rounded-lg shadow-md">
    <h2 className="text-3xl font-bold text-gray-900 mb-6">Example Datasets</h2>
    <p className="text-gray-700 leading-relaxed mb-8">
      Below are examples of how FERAL was applied to diverse datasets spanning 
      single-animal, dyadic, and collective behaviors. Each example includes a brief 
      description of the dataset and analysis procedure.
    </p>

    {/* Worms Section */}
    <div className="mb-12">
      <h3 className="text-2xl font-semibold text-gray-900 mb-4">🪱 Worms (C. elegans)</h3>
      <p className="text-gray-700 leading-relaxed mb-4">
        Recordings of freely moving <em>C. elegans</em> performing four canonical locomotor behaviors: 
        forward crawling, reverse crawling, turning, and pausing. The animal was kept centered 
        within the field of view, and FERAL was used to directly segment these behaviors from raw video. 
        Because forward and reverse crawling appear nearly identical in single frames, temporal 
        context was essential—FERAL leveraged overlapping chunk inference to correctly 
        disambiguate directionality and produce smooth behavioral ethograms. Credits: Friedericke Buck
      </p>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <img src="src\videos\worms_example.gif"
            alt="worms example"
            className="w-full rounded-lg shadow-md"
/       >
      </div>
      <img src="src/images/worms_figure.png" alt="FERAL segmentation on C. elegans" className="w-full mt-4 rounded-lg shadow-md" />
    </div>

    {/* Ants Section */}
    <div className="mb-12">
      <h3 className="text-2xl font-semibold text-gray-900 mb-4">🐜 Ants (O. biroi)</h3>
      <p className="text-gray-700 leading-relaxed mb-4">
        This dataset captured adult–larva interactions in the clonal raider ant <em>Ooceraea biroi</em>. 
        Videos were recorded from the side at 10 frames per second, with behaviors such as self-grooming 
        and allogrooming manually annotated as ground truth. These tasks are challenging for 
        traditional pose-based pipelines due to occlusion and side-view geometry. 
        FERAL identified both grooming types directly from raw video, without explicit tracking 
        or pose estimation, showing its ability to capture socially contingent behaviors. Credits: Janet Zhao and Dominic Frank
      </p>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <img
  src="src\videos\ants_example.gif"
  alt="Ants example"
  className="w-full rounded-lg shadow-md"
/>
      </div>
      <img src="src/images/ants_figure.png" alt="FERAL segmentation on O. biroi interactions" className="w-full mt-4 rounded-lg shadow-md" />
    </div>

    {/* Collective Behavior Section */}
    <div className="mb-4">
      <h3 className="text-2xl font-semibold text-gray-900 mb-4">Collective Behavior</h3>
      <p className="text-gray-700 leading-relaxed mb-4">
        Recordings of <em>O. biroi</em> colonies filmed continuously over several days to study 
        emergent group raiding behavior. FERAL accurately detected the onset and duration of 
        collective raids directly from raw frames, even in dense colonies where individuals 
        overlapped and occluded each other. This demonstrates FERAL’s ability to identify 
        colony-level states without explicit multi-animal tracking. Credits: Tomas Kay
      </p>
      <img src="src/images/collective_figure.png" alt="FERAL detection of collective raids" className="w-full rounded-lg shadow-md" />
    </div>
  </section>
);


        const ContactSection = () => {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                subject: '',
                message: ''
            });

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Create mailto link with both recipients
                const recipients = 'jrazzauti@rockefeller.edu,pskovorodnikov@rockefeller.edu';
                const subject = encodeURIComponent(formData.subject || 'FERAL AI Inquiry');
                const body = encodeURIComponent(
                    `Name: ${formData.name}\n` +
                    `Email: ${formData.email}\n\n` +
                    `Message:\n${formData.message}`
                );
                
                const mailtoLink = `mailto:${recipients}?subject=${subject}&body=${body}`;
                window.location.href = mailtoLink;
            };

            const sendDirectEmail = (email, name) => {
                const subject = encodeURIComponent('FERAL AI Inquiry');
                const body = encodeURIComponent(`Hello ${name},\n\nI have a question about FERAL AI:\n\n`);
                const mailtoLink = `mailto:${email}?subject=${subject}&body=${body}`;
                window.location.href = mailtoLink;
            };

            return (
                <section id="contact" className="bg-white p-8 rounded-lg shadow-md">
                    <h2 className="text-3xl font-bold text-gray-900 mb-4">Contact Us</h2>
                    <p className="text-gray-700 leading-relaxed">
                        Have questions about FERAL? Need help with your research or implementation? 
                        We're here to help! Reach out to us for support, collaborations, or any inquiries.
                    </p>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* Contact Form */}
                        <div>
                            <h3 className="text-2xl font-semibold text-gray-900 mb-6">📧 Send us a Message</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-2">
                                        Your Name *
                                    </label>
                                    <input
                                        type="text"
                                        id="name"
                                        name="name"
                                        required
                                        value={formData.name}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Enter your full name"
                                    />
                                </div>

                                <div>
                                    <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-2">
                                        Your Email *
                                    </label>
                                    <input
                                        type="email"
                                        id="email"
                                        name="email"
                                        required
                                        value={formData.email}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="your.email@institution.edu"
                                    />
                                </div>

                                <div>
                                    <label htmlFor="subject" className="block text-sm font-medium text-gray-700 mb-2">
                                        Subject
                                    </label>
                                    <input
                                        type="text"
                                        id="subject"
                                        name="subject"
                                        value={formData.subject}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Brief description of your inquiry"
                                    />
                                </div>

                                <div>
                                    <label htmlFor="message" className="block text-sm font-medium text-gray-700 mb-2">
                                        Message *
                                    </label>
                                    <textarea
                                        id="message"
                                        name="message"
                                        required
                                        rows="6"
                                        value={formData.message}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"
                                        placeholder="Tell us about your project, questions, or how we can help..."
                                    ></textarea>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full bg-gray-900 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1"
                                >
                                    📧 Send Message
                                </button>
                            </form>

                            <p className="text-sm text-gray-600 mt-4">
                                * This will open your default email client to send the message
                            </p>
                        </div>

                        {/* Direct Contact & Team Info */}
                        <div className="space-y-6">
                            <div>
                                <h3 className="text-2xl font-semibold text-gray-900 mb-6">👥 Acknowledgments</h3>
                                
                                {/* Team Member 1 */}
                                <div className="bg-blue-50 p-6 rounded-lg border border-blue-200 mb-4">
                                    <h4 className="text-lg font-semibold text-blue-900 mb-2">
                                        🧬 Jacopo Razzauti
                                    </h4>
                                    <p className="text-sm text-blue-700 mb-3">
                                        Researcher & Co-Developer
                                    </p>
                                    <button
                                        onClick={() => sendDirectEmail('jrazzauti@rockefeller.edu', 'Jacopo')}
                                        className="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 text-sm"
                                    >
                                        ✉️ jrazzauti@rockefeller.edu
                                    </button>
                                </div>

                                {/* Team Member 2 */}
                                <div className="bg-green-50 p-6 rounded-lg border border-green-200">
                                    <h4 className="text-lg font-semibold text-green-900 mb-2">
                                        🤖 Peter Skovorodnikov
                                    </h4>
                                    <p className="text-sm text-green-700 mb-3">
                                        Researcher & Lead Developer
                                    </p>
                                    <button
                                        onClick={() => sendDirectEmail('pskovorodnikov@rockefeller.edu', 'Peter')}
                                        className="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 text-sm"
                                    >
                                        ✉️ pskovorodnikov@rockefeller.edu
                                    </button>
                                </div>
                            </div>

                            {/* Institution Info */}
                            <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <div className="flex items-center mb-2">
                                    <span className="mr-2">🏛️</span>
                                    <span className="font-semibold text-blue-900">The Rockefeller University</span>
                                </div>
                                <p className="text-sm text-blue-700">
                                    Data Science Platform <br/>
                                    Laboratory of Neurogenetics and Behavior<br/>
                                    1230 York Avenue, New York, NY 10065
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        

        const FAQSection = () => (
            <section id="faq" className="bg-white p-8 rounded-lg shadow-md">
                <h2 className="text-3xl font-bold text-gray-900 mb-4">Frequently Asked Questions</h2>
                <div className="space-y-4">
                    <details className="group border-b border-gray-200 pb-4">
                        <summary className="flex justify-between items-center cursor-pointer text-lg font-semibold text-gray-800">
                            How accurate is Feral AI?
                            <svg className="h-5 w-5 text-gray-500 group-open:rotate-180 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <p className="mt-2 text-gray-600">
                            Feral leverages state-of-the-art deep learning models, achieving high accuracy comparable to,
                            and often exceeding, manual annotation for a wide range of behaviors. Accuracy can vary based on
                            video quality and specific behavioral complexity.
                        </p>
                    </details>
                    <details className="group border-b border-gray-200 pb-4">
                        <summary className="flex justify-between items-center cursor-pointer text-lg font-semibold text-gray-800">
                            What video formats are supported?
                            <svg className="h-5 w-5 text-gray-500 group-open:rotate-180 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <p className="mt-2 text-gray-600">
                            Feral AI supports common video formats such as MP4, AVI, MOV, and MKV. For best results,
                            we recommend using high-resolution videos with stable lighting.
                        </p>
                    </details>
                </div>
            </section>
        );

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

