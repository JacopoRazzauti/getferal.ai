<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic -->
    <link rel="icon" href="/favicon.ico" sizes="any"><!-- .ico with embedded 16 & 32 px -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">

    <!-- Optional extras -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png"><!-- iOS home-screen -->
    <meta name="theme-color" content="#ffffff"><!-- address-bar tint on mobile Chrome -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FERAL Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 font-inter text-gray-800 antialiased">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Main App Component
        function App() {
            const [activeSection, setActiveSection] = useState('home');
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);

            const handleNavClick = (section) => {
                setActiveSection(section);
                setIsSidebarOpen(false);
                document.getElementById(section)?.scrollIntoView({ behavior: 'smooth' });
            };

            return (
                <div className="min-h-screen bg-gray-100 font-inter text-gray-800 antialiased flex flex-col">
                    {/* Header */}
                    <header className="bg-white shadow-sm py-4 px-6 md:px-8 flex flex-col md:flex-row items-center justify-between sticky top-0 z-50">
                        <div className="flex items-center justify-center md:justify-start w-full md:w-auto relative mb-2 md:mb-0">
                            <button
                                className="md:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 absolute left-0"
                                onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                                aria-label="Toggle navigation"
                            >
                                <svg className="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    {isSidebarOpen ? (
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                    ) : (
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" />
                                    )}
                                </svg>
                            </button>
                            <img
                                src="./src/images/feral-logo.png"
                                alt="Feral AI Logo"
                                className="h-8 w-8 mr-2 ml-10 md:ml-0"
                            />
                            <h1 className="text-3xl font-bold text-gray-900">FERAL</h1>
                        </div>
                        <nav className="hidden md:flex space-x-6 mt-4 md:mt-0">
                            <NavLink section="home" current={activeSection} onClick={handleNavClick}>Home</NavLink>
                            <NavLink section="getting-started" current={activeSection} onClick={handleNavClick}>Getting Started</NavLink>
                            <NavLink section="video-preparation" current={activeSection} onClick={handleNavClick}>Video Preparation</NavLink>
                            <NavLink section="label-preparation" current={activeSection} onClick={handleNavClick}>Label Preparation</NavLink>
                            <NavLink section="dataset-validator" current={activeSection} onClick={handleNavClick}>Dataset Validator</NavLink>
                            <NavLink section="running-feral" current={activeSection} onClick={handleNavClick}>Running Feral</NavLink>
                            <NavLink section="contact" current={activeSection} onClick={handleNavClick}>Contact</NavLink>
                        </nav>
                    </header>

                    {/* Main Content Area */}
                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar */}
                        <aside className={`fixed inset-y-0 left-0 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 w-64 bg-white shadow-lg p-6 overflow-y-auto transition-transform duration-300 ease-in-out z-40 md:z-auto`}>
                            <h2 className="text-lg font-semibold text-gray-900 mb-4">Documentation</h2>
                            <nav className="space-y-2">
                                <SidebarLink section="home" current={activeSection} onClick={handleNavClick}>Introduction</SidebarLink>
                                <SidebarLink section="getting-started" current={activeSection} onClick={handleNavClick}>Getting Started</SidebarLink>
                                <SidebarLink section="video-preparation" current={activeSection} onClick={handleNavClick}>Video Preparation</SidebarLink>
                                <SidebarLink section="label-preparation" current={activeSection} onClick={handleNavClick}>Label Preparation</SidebarLink>
                                <SidebarLink section="dataset-validator" current={activeSection} onClick={handleNavClick}>Dataset Validator</SidebarLink>
                                <SidebarLink section="running-feral" current={activeSection} onClick={handleNavClick}>Running Feral</SidebarLink>
                                
                                <SidebarLink section="contact" current={activeSection} onClick={handleNavClick}>Contact Us</SidebarLink>
                                
                            </nav>
                        </aside>

                        {/* Content Area */}
                        <main className="flex-1 p-6 md:p-8 overflow-y-auto">
                            {activeSection === 'home' && <HomeSection handleNavClick={handleNavClick} />}
                            {activeSection === 'getting-started' && <GettingStartedSection handleNavClick={handleNavClick} />}
                            {activeSection === 'video-preparation' && <VideoPreparationSection />}
                            {activeSection === 'label-preparation' && <LabelPreparationSection />}
                            {activeSection === 'running-feral' && <RunningFeralSection handleNavClick={handleNavClick} />}
                            {activeSection === 'dataset-validator' && <DatasetValidatorSection />}
                            {activeSection === 'contact' && <ContactSection />}
                        </main>
                    </div>

                    {/* Overlay for mobile sidebar */}
                    {isSidebarOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden" onClick={() => setIsSidebarOpen(false)}></div>
                    )}

                    {/* Footer */}
                    <footer className="bg-gray-900 text-white py-6 px-8 text-center text-sm">
                        <p>&copy; {new Date().getFullYear()} Feral AI. All rights reserved.</p>
                        <p className="mt-2">
                            <a href="/privacy-policy" className="text-gray-400 hover:underline mx-2">Privacy Policy</a> |
                            <a href="/terms-of-service" className="text-gray-400 hover:underline mx-2">Terms of Service</a>
                        </p>
                    </footer>
                </div>
            );
        }

        // Navigation Components
        const NavLink = ({ section, current, onClick, children }) => (
            <button
                className={`px-3 py-2 rounded-md text-sm font-medium ${current === section ? 'bg-gray-200 text-gray-900' : 'text-gray-700 hover:bg-gray-100 hover:text-gray-900'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300`}
                onClick={() => onClick(section)}
            >
                {children}
            </button>
        );

        const SidebarLink = ({ section, current, onClick, children }) => (
            <button
                className={`block w-full text-left px-3 py-2 rounded-md text-sm ${current === section ? 'bg-gray-200 text-gray-900 font-semibold' : 'text-gray-700 hover:bg-gray-50 hover:text-gray-900'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300`}
                onClick={() => onClick(section)}
            >
                {children}
            </button>
        );

        // Content Sections
        const HomeSection = ({ handleNavClick }) => (
            <section id="home" className="bg-white p-8 rounded-lg shadow-md mb-8">
                <h2 className="text-3xl font-bold text-gray-900 mb-4">About FERAL</h2>
                
                <p className="text-gray-700 leading-relaxed mb-4">
                    AI is advancing at lightning speed: new models arrive every month, and their quality is improving exponentially. To put that power in the hands of biologists, we created FERAL.
                </p>
                
                <p className="text-gray-700 leading-relaxed mb-4">
                    FERAL (Feature Extraction for Recognition of Animal Locomotion) is an open-source solution that segments animal behavior directly 
                    from raw videos: <strong> no tracking, no pose estimation required </strong>. FERAL uses cutting‚Äëedge opensource video‚Äëunderstanding models. 
                    That lets it analyze behavior in complex lab and field recordings that were once out of reach. 
                    And on existing benchmarks, it beats the previous state of the art by a wide margin.
                </p>

                <p className="text-gray-700 leading-relaxed mb-4">
                    You don‚Äôt need key-point tracking, just raw videos and labels. Set everything up in the cloud in 
                    under five minutes and run it with a single command. If you encounter any issues, please reach out 
                    through the ‚ÄúContact‚Äù section. We‚Äôll be happy to assist with anything you need.
                </p>

                <p className="text-gray-700 leading-relaxed mb-6">
                    To get started, we suggest that you see the ‚ÄúGetting Started‚Äù section.
                </p>

                {/* Acknowledgment Section */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 className="text-xl font-semibold text-gray-900 mb-4">üë®‚Äçüî¨ Acknowledgments</h3>
                    <p className="text-gray-700 leading-relaxed mb-4">
                        FERAL was developed at The Rockefeller University by:
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-white p-4 rounded-lg border border-gray-100">
                            <div className="flex items-center mb-2">
                                <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                    <span className="text-green-600 font-semibold text-sm">PS</span>
                                </div>
                                <div>
                                    <h4 className="font-semibold text-gray-900">Peter Skovorodnikov</h4>
                                    <p className="text-sm text-gray-600">Researcher & Lead Developer</p>
                                </div>
                            </div>
                            <p className="text-sm text-gray-700">
                                <a href="mailto:pskovorodnikov@rockefeller.edu" className="text-blue-600 hover:underline">
                                    pskovorodnikov@rockefeller.edu
                                </a>
                            </p>
                        </div>
                        <div className="bg-white p-4 rounded-lg border border-gray-100">
                            <div className="flex items-center mb-2">
                                <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                    <span className="text-blue-600 font-semibold text-sm">JR</span>
                                </div>
                                <div>
                                    <h4 className="font-semibold text-gray-900">Jacopo Razzauti</h4>
                                    <p className="text-sm text-gray-600">Co-Developer & Researcher</p>
                                </div>
                            </div>
                            <p className="text-sm text-gray-700">
                                <a href="mailto:jrazzauti@rockefeller.edu" className="text-blue-600 hover:underline">
                                    jrazzauti@rockefeller.edu
                                </a>
                            </p>
                        </div>
                    </div>
                </div>

                <div className="mt-6 flex flex-wrap gap-4">
                    <button
                        onClick={() => handleNavClick('getting-started')}
                        className="bg-gray-900 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1"
                    >
                        Get Started
                    </button>
                </div>
            </section>
        );

        const GettingStartedSection = ({ handleNavClick }) => (
            <section
            id="getting-started"
            className="bg-white p-8 rounded-lg shadow-md mb-8"
            >
            <h2 className="text-3xl font-bold text-gray-900 mb-4">Getting Started</h2>
        
            {/* High-level intro */}
            <p className="text-gray-700 leading-relaxed mb-6">
                To use FERAL you need to have (1) videos and (2) discrete behaviors labels for some of these videos. 
                Then FERAL trains a deep learning model using labels you provided, evaluates quality, and 
                predicts labels for unannotated videos. 
            </p>

            <p className="text-gray-700 leading-relaxed mb-6">
                FERAL workflow has <strong>3 stages</strong>:
            </p>
        
            {/* Pipeline list */}
            <ol className="space-y-6 md:space-y-4 list-decimal list-inside">
                <li>
                <span className="font-semibold text-gray-900">Prepare your videos.</span>{" "}
                FERAL needs seek-able video files (quickly load frames from the middle of the video)
                <button
                    onClick={() => handleNavClick("video-preparation")}
                    className="ml-2 text-blue-600 hover:underline text-sm"
                >
                    (see Video&nbsp;Preparation)
                </button>
                </li>
        
                <li>
                <span className="font-semibold text-gray-900">Prepare your labels.</span>{" "}
                Convert annotations into the JSON schema FERAL expects
                <button
                    onClick={() => handleNavClick("label-preparation")}
                    className="ml-2 text-blue-600 hover:underline text-sm"
                >
                    (see Label&nbsp;Preparation)
                </button>
                </li>
        
                <li>
                <span className="font-semibold text-gray-900">Run FERAL.</span> Train a
                model on your dataset and generate labels for unannotated videos.
                <button
                    onClick={() => handleNavClick("running-feral")}
                    className="ml-2 text-blue-600 hover:underline text-sm"
                >
                    (how to run)
                </button>
                </li>
            </ol>
        
            {/* Two-option install cards */}
            <h3 className="text-2xl font-semibold text-gray-800 mt-10 mb-4">
                Choose how to run FERAL
            </h3>
        
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Local install */}
                <div className="bg-blue-50 border border-blue-200 p-6 rounded-lg">
                <div className="flex items-center mb-3">
                    <div className="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold mr-3">
                    1
                    </div>
                    <h4 className="text-lg font-semibold text-blue-900">
                    Local Installation
                    </h4>
                </div>
                <p className="text-sm text-blue-800 mb-4">
                    Best for users with their own GPUs and command-line experience.
                </p>
                <ul className="text-blue-700 text-sm space-y-1">
                    <li>üíª&nbsp;Install CUDA + PyTorch yourself</li>
                    <li>üîí&nbsp;Data never leaves your machine</li>
                    <li>üí∏&nbsp;Completely free</li>
                </ul>
                </div>
        
                {/* RunPod */}
                <div className="bg-green-50 border border-green-200 p-6 rounded-lg relative">
                <div className="flex items-center mb-3">
                    <div className="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center font-bold mr-3">
                    2
                    </div>
                    <h4 className="text-lg font-semibold text-green-900">RunPod</h4>
                </div>
                <p className="text-sm text-green-800 mb-4">
                    Launch a GPU server in&nbsp;5 minutes. Pay-as-you-go.
                </p>
                <ul className="text-green-700 text-sm space-y-1">
                    <li>üöÄ High-performance GPUs</li>
                    <li>üèéÔ∏è Few-click setup</li>
                    <li>üí∏ No long-term commitment</li>
                </ul>
                </div>
            </div>
        
            {/* Quick-nav buttons */}
            <div className="mt-10 flex flex-wrap gap-4">
                <button
                onClick={() => handleNavClick("video-preparation")}
                className="bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
                >
                üìΩÔ∏è Video Prep Guide
                </button>
                <button
                onClick={() => handleNavClick("label-preparation")}
                className="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
                >
                üè∑Ô∏è Label Prep Guide
                </button>
                <button
                onClick={() => handleNavClick("running-feral")}
                className="bg-gray-900 hover:bg-gray-700 text-white font-medium py-2 px-5 rounded-lg shadow-md transition duration-200"
                >
                üöÄ Run FERAL
                </button>
            </div>
            </section>
        );
  

        const VideoPreparationSection = () => {
            const [isCodeExpanded, setIsCodeExpanded] = useState(false);
            const [copySuccess, setCopySuccess] = useState(false);

            const reencodingScript = `#!/usr/bin/env python3
"""
FERAL Video Re-encoding Script with Auto-FFmpeg Installation
Converts videos to the required format for FERAL processing.

Features:
- Automatically downloads and sets up FFmpeg if not installed
- Cross-platform support (Windows, macOS, Linux)
- Parallel processing for faster conversion
- Progress tracking and error handling

Usage:
    python reencode_videos.py /path/to/input/videos /path/to/output/videos

Requirements:
    - Python 3.6+
    - Internet connection (for FFmpeg auto-download if needed)
"""

import os
import sys
import subprocess
import argparse
import platform
import urllib.request
import zipfile
import tarfile
import shutil
from multiprocessing import Pool
import mimetypes
from pathlib import Path

# FFmpeg download URLs for different platforms
FFMPEG_URLS = {
    'Windows': 'https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip',
    'Darwin': 'https://evermeet.cx/ffmpeg/ffmpeg-6.0.zip',  # macOS
    'Linux': 'https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz'
}

def get_platform():
    """Get the current platform name."""
    system = platform.system()
    if system == 'Darwin':
        return 'Darwin'  # macOS
    elif system == 'Windows':
        return 'Windows'
    else:
        return 'Linux'

def download_file(url, filename):
    """Download a file with progress indication."""
    print(f"Downloading {filename}...")
    
    def progress_hook(block_num, block_size, total_size):
        downloaded = block_num * block_size
        if total_size > 0:
            percent = min(100, (downloaded * 100) // total_size)
            print(f"\\rProgress: {percent}% ({downloaded}/{total_size} bytes)", end='')
    
    urllib.request.urlretrieve(url, filename, reporthook=progress_hook)
    print("\\nDownload complete!")

def extract_ffmpeg(archive_path, extract_dir):
    """Extract FFmpeg from downloaded archive."""
    print(f"Extracting {archive_path}...")
    
    if archive_path.endswith('.zip'):
        with zipfile.ZipFile(archive_path, 'r') as zip_ref:
            zip_ref.extractall(extract_dir)
    elif archive_path.endswith('.tar.xz'):
        with tarfile.open(archive_path, 'r:xz') as tar_ref:
            tar_ref.extractall(extract_dir)
    
    print("Extraction complete!")

def find_ffmpeg_binary(extract_dir, platform_name):
    """Find the FFmpeg binary in the extracted directory."""
    if platform_name == 'Windows':
        # Look for ffmpeg.exe in subdirectories
        for root, dirs, files in os.walk(extract_dir):
            if 'ffmpeg.exe' in files:
                return os.path.join(root, 'ffmpeg.exe')
    else:
        # Look for ffmpeg binary in subdirectories  
        for root, dirs, files in os.walk(extract_dir):
            if 'ffmpeg' in files:
                ffmpeg_path = os.path.join(root, 'ffmpeg')
                # Make sure it's executable
                os.chmod(ffmpeg_path, 0o755)
                return ffmpeg_path
    
    return None

def setup_ffmpeg():
    """Download and setup FFmpeg if not available."""
    platform_name = get_platform()
    
    # Check if ffmpeg is already available
    try:
        subprocess.run(['ffmpeg', '-version'], capture_output=True, check=True)
        print("‚úÖ FFmpeg is already installed and available!")
        return 'ffmpeg'
    except (subprocess.CalledProcessError, FileNotFoundError):
        print("FFmpeg not found in PATH. Setting up FFmpeg automatically...")
    
    # Create ffmpeg directory
    ffmpeg_dir = os.path.join(os.getcwd(), 'ffmpeg_portable')
    os.makedirs(ffmpeg_dir, exist_ok=True)
    
    # Check if we already have a portable version
    existing_ffmpeg = None
    if platform_name == 'Windows':
        existing_ffmpeg = os.path.join(ffmpeg_dir, 'ffmpeg.exe')
    else:
        existing_ffmpeg = os.path.join(ffmpeg_dir, 'ffmpeg')
    
    if existing_ffmpeg and os.path.exists(existing_ffmpeg):
        print("‚úÖ Using existing portable FFmpeg installation!")
        return existing_ffmpeg
    
    # Download FFmpeg
    if platform_name not in FFMPEG_URLS:
        raise RuntimeError(f"Unsupported platform: {platform_name}")
    
    url = FFMPEG_URLS[platform_name]
    archive_name = url.split('/')[-1]
    archive_path = os.path.join(ffmpeg_dir, archive_name)
    
    try:
        download_file(url, archive_path)
        extract_ffmpeg(archive_path, ffmpeg_dir)
        
        # Find the binary
        ffmpeg_binary = find_ffmpeg_binary(ffmpeg_dir, platform_name)
        
        if not ffmpeg_binary:
            raise RuntimeError("Could not find FFmpeg binary after extraction")
        
        # Test the binary
        subprocess.run([ffmpeg_binary, '-version'], capture_output=True, check=True)
        print("‚úÖ FFmpeg setup complete!")
        
        # Clean up archive
        os.remove(archive_path)
        
        return ffmpeg_binary
        
    except Exception as e:
        print(f"‚ùå Error setting up FFmpeg: {e}")
        print("Please install FFmpeg manually from https://ffmpeg.org/download.html")
        sys.exit(1)

def is_video_file(filepath):
    """Check if file is a video based on MIME type."""
    mime_type, _ = mimetypes.guess_type(filepath)
    return mime_type is not None and mime_type.startswith('video')

def process_file(args):
    """Process a single video file with ffmpeg."""
    input_path, output_dir, ffmpeg_binary, preset = args
    
    # Verify it's a video file
    if not is_video_file(input_path):
        print(f"Skipping non-video file: {input_path}")
        return False
    
    # Create output filename with .mp4 extension
    input_name = Path(input_path).stem
    output_path = os.path.join(output_dir, f"{input_name}.mp4")
    
    # Skip if output already exists
    if os.path.exists(output_path):
        print(f"Output already exists, skipping: {output_path}")
        return True
    
    # FFmpeg command for FERAL-compatible encoding
    cmd = [
        ffmpeg_binary, "-i", input_path,
        "-vf", "scale=512:512:flags=lanczos",  # Resize to 512x512 with high-quality scaling
        "-c:v", "libx264",                      # H.264 video codec
        "-pix_fmt", "yuv420p",                  # Standard pixel format
        "-crf", "25",                           # Constant rate factor (quality)
        "-preset", preset,                      # Encoding speed/quality balance
        "-an",                                  # Remove audio
        "-y",                                   # Overwrite output files
        output_path
    ]
    
    try:
        print(f"Processing: {os.path.basename(input_path)} -> {os.path.basename(output_path)}")
        result = subprocess.run(cmd, capture_output=True, text=True, check=True)
        print(f"‚úÖ Successfully processed: {os.path.basename(output_path)}")
        return True
    except subprocess.CalledProcessError as e:
        print(f"‚ùå Error processing {input_path}: {e.stderr}")
        return False

def main():
    parser = argparse.ArgumentParser(description="Re-encode videos for FERAL processing with auto-FFmpeg setup")
    parser.add_argument("input_dir", help="Directory containing input videos")
    parser.add_argument("output_dir", help="Directory for re-encoded videos")
    parser.add_argument("--processes", "-p", type=int, default=4, 
                       help="Number of parallel processes (default: 4)")
    parser.add_argument("--preset", default="medium",
                       choices=["ultrafast", "superfast", "veryfast", "faster", "fast", "medium", "slow", "slower", "veryslow"],
                       help="FFmpeg encoding preset (default: medium)")
    
    args = parser.parse_args()
    
    print("üé¨ FERAL Video Re-encoding Script")
    print("=" * 50)
    
    # Validate input directory
    if not os.path.isdir(args.input_dir):
        print(f"‚ùå Error: Input directory does not exist: {args.input_dir}")
        sys.exit(1)
    
    # Create output directory
    os.makedirs(args.output_dir, exist_ok=True)
    
    # Setup FFmpeg (download if needed)
    ffmpeg_binary = setup_ffmpeg()
    
    # Get all video files in input directory
    input_files = []
    for filename in os.listdir(args.input_dir):
        filepath = os.path.join(args.input_dir, filename)
        if os.path.isfile(filepath) and is_video_file(filepath):
            input_files.append((filepath, args.output_dir, ffmpeg_binary, args.preset))
    
    if not input_files:
        print("‚ùå No video files found in input directory.")
        sys.exit(1)
    
    print(f"üìÅ Found {len(input_files)} video files to process")
    print(f"‚öôÔ∏è  Using {args.processes} parallel processes")
    print(f"üíæ Output directory: {args.output_dir}")
    print(f"üîß FFmpeg preset: {args.preset}")
    print("-" * 50)
    
    # Process files in parallel
    with Pool(processes=args.processes) as pool:
        results = pool.map(process_file, input_files)
    
    successful = sum(results)
    total = len(input_files)
    print("-" * 50)
    print(f"üéâ Processing complete: {successful}/{total} files successful")
    
    if successful < total:
        print(f"‚ö†Ô∏è  {total - successful} files failed to process")
        sys.exit(1)
    else:
        print("‚ú® All videos successfully re-encoded for FERAL!")
        print(f"üìÇ Converted videos are in: {args.output_dir}")

if __name__ == "__main__":
    main()`;

            const copyToClipboard = async () => {
                try {
                    await navigator.clipboard.writeText(reencodingScript);
                    setCopySuccess(true);
                    setTimeout(() => setCopySuccess(false), 2000);
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            };

            const downloadScript = () => {
                const blob = new Blob([reencodingScript], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'reencode_videos.py';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
            <section id="video-preparation" className="bg-white p-8 rounded-lg shadow-md mb-8">
                <h2 className="text-3xl font-bold text-gray-900 mb-6">
                    Video Preparation&nbsp;Guide
                  </h2>
                
                  {/* Quick-start checklist */}
                  <ol className="list-decimal list-inside space-y-4 text-gray-700 leading-relaxed mb-6">
                    <li>
                      Place <strong>all videos you want FERAL to use</strong> in a single
                      folder. That folder should contain <em>only</em> those videos.
                    </li>
                
                    <li>
                      Verify you have <strong>Python 3</strong> installed. Run&nbsp;
                      <code className="bg-gray-100 px-1 py-0.5 rounded">python --version</code>;
                      it should print something like&nbsp;
                      <code className="bg-gray-100 px-1 py-0.5 rounded">Python&nbsp;3.9.10</code>.
                    </li>
                
                    <li>
                      Save the script below as&nbsp;
                      <code className="bg-gray-100 px-1 py-0.5 rounded">reencode_videos.py</code>.
                    </li>
                  </ol>

                {/* Collapsible Code Section */}
                <div className="mb-4">
                    <button
                        onClick={() => setIsCodeExpanded(!isCodeExpanded)}
                        className="w-full flex items-center justify-between p-4 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-lg transition-colors duration-200"
                    >
                        <span className="font-medium text-gray-800">
                            {isCodeExpanded ? 'üîΩ Hide Re-encoding Script' : 'üìù Show Re-encoding Script'}
                        </span>
                        <svg
                            className={`w-5 h-5 transform transition-transform duration-200 ${isCodeExpanded ? 'rotate-180' : ''}`}
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    {isCodeExpanded && (
                        <div className="mt-4 border border-gray-300 rounded-lg overflow-hidden">
                            {/* Action Buttons */}
                            <div className="bg-gray-50 p-4 border-b border-gray-200 flex gap-3">
                                <button
                                    onClick={copyToClipboard}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${
                                        copySuccess 
                                            ? 'bg-green-500 text-white' 
                                            : 'bg-blue-500 hover:bg-blue-600 text-white'
                                    }`}
                                >
                                    {copySuccess ? (
                                        <>
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                            Copied!
                                        </>
                                    ) : (
                                        <>
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                            </svg>
                                            Copy Code
                                        </>
                                    )}
                                </button>
                                <button
                                    onClick={downloadScript}
                                    className="flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors duration-200"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    Download .py
                                </button>
                            </div>

                            {/* Code Display */}
                            <div className="bg-gray-900 p-4 text-sm font-mono overflow-x-auto text-green-400 max-h-96 overflow-y-auto">
                                <pre><code>{reencodingScript}</code></pre>
                            </div>
                        </div>
                    )}
                </div>

                <p className="text-gray-700 leading-relaxed mb-6">
                    4.&nbsp;Run&nbsp;
                    <code className="bg-gray-100 px-1 py-0.5 rounded">
                      python reencode_videos.py /path/to/video/folder /path/to/output/folder
                    </code>
                    .&nbsp;Add&nbsp;
                    <code className="bg-gray-100 px-1 py-0.5 rounded">--processes&nbsp; N </code>
                    &nbsp;if you want to change the number of parallel processes (default is 4).
                  </p>
                
                  {/* What & why */}
                  <h3 className="text-2xl font-semibold text-gray-900 mb-3">
                    What does this script do?
                  </h3>
                
                  <p className="text-gray-700 leading-relaxed mb-6">
                    During training, FERAL samples frames from anywhere in a video, so video encoding 
                    should support reading frames from the middle of the video.
                    Otherwise dataloading will throttle the GPU.
                    Unfortunately, many video encodings can‚Äôt do that efficiently. This script
                    re-encodes your footage with an encoding that supports this operation efficiently.
                  </p>
                
                  <p className="text-gray-700 leading-relaxed mb-6">
                    Our model currently expects <strong>256&nbsp;√ó&nbsp;256 px</strong> input,
                    so the script also resizes each video. That reduces file size and will speeds up
                    data transfer to the cloud.
                  </p>
                
                  <p className="text-gray-700 leading-relaxed">
                    The script uses <strong>FFmpeg</strong>. If FFmpeg isn‚Äôt installed, FERAL detects your OS,
                     downloads a portable build into
                    <code className="bg-gray-100 px-1 py-0.5 rounded">ffmpeg_portable</code>,
                    and reuses it next time.
                  </p>             
            </section>
        );
        };

        // LabelPreparationSection.jsx (or inline with your other sections)
        const LabelPreparationSection = () => (
            <section
            id="label-preparation"
            className="bg-white p-8 rounded-lg shadow-md mb-8"
            >
            <h2 className="text-3xl font-bold text-gray-900 mb-4">
                Label Preparation
            </h2>
                <p className="text-gray-700 leading-relaxed mb-4">
                    You need to structure your labels as a JSON file with a specific format. Here is an example of such file
                </p>

                <div className="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-x-auto">
                    <pre><code>{`{
  "class_names": {
    "0": "other",
    "1": "contact",
    "2": "attempt",
    "3": "flight",
    "4": "kicking",
    "5": "genital_contact",
    "6": "mating"
  },
  "labels": {
    "video_file_1.mp4": [0, 0, 1, 1, 2, 0, 0, 3, 3, 0],
    "video_file_2.mp4": [0, 0, 0, 4, 4, 5, 6, 6, 0, 0],
    "video_file_3.mp4": [0, 1, 1, 0, 0, 0, 2, 2, 3, 0]
  },
  "splits": {
    "train": [
      "video_file_1.mp4",
      "video_file_2.mp4"
    ],
    "val": [
      "video_file_3.mp4"
    ]
    "inference": [
      "video_file_4.mp4",
      "video_file_5.mp4",
      "video_file_6.mp4",
    ]
  }
}`}</code></pre>
                </div>

                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">Field Descriptions</h3>
                <div className="space-y-4">
                    <div>
                        <h4 className="text-lg font-semibold text-gray-800 mb-2">class_names</h4>
                        <p className="text-gray-700 leading-relaxed">
                            <strong>Required:</strong> Yes<br/>
                            <strong>Description:</strong> Maps numeric class IDs to human-readable class names<br/>
                            <strong>Format:</strong> <code className="bg-gray-100 px-2 py-1 rounded text-sm">{'{'}"class_id": "class_name"{'}'}</code><br/>
                            <strong>Note:</strong> Class IDs must be strings, even for numeric values (e.g., <code className="bg-gray-100 px-2 py-1 rounded text-sm">"0"</code>, <code className="bg-gray-100 px-2 py-1 rounded text-sm">"1"</code>). 
                            Class ids have to be consecutive integers from 0 to number_of_classes - 1. 
                            If you have a background class, that's assigned when none of meaningfull classes apply, call it "other", then it will be excluded in calculations of metrics that averrage things across classess. 
                        </p>
                    </div>

                    <div>
                        <h4 className="text-lg font-semibold text-gray-800 mb-2">labels</h4>
                        <p className="text-gray-700 leading-relaxed">
                            <strong>Required:</strong> Yes<br/>
                            <strong>Description:</strong> Contains frame-by-frame behavior labels for each video<br/>
                            <strong>Format:</strong> <code className="bg-gray-100 px-2 py-1 rounded text-sm">{'{'}"video_filename.mp4": [array_of_class_ids]{'}'}</code><br/>
                            <strong>Note:</strong> Each key should be a filename of the video (with extention). Each value in the dictionary is an integer array 
                            of the same length as number of frames in teh corresponding video. Each value in the array must correspond to a class ID defined in <code className="bg-gray-100 px-2 py-1 rounded text-sm">class_names</code>
                        </p>
                    </div>

                    <div>
                        <h4 className="text-lg font-semibold text-gray-800 mb-2">splits</h4>
                        <p className="text-gray-700 leading-relaxed">
                            <strong>Required:</strong> Yes<br/>
                            <strong>Description:</strong> Defines dataset partitions for training and validation<br/>
                            <strong>Fields:</strong><br/>
                            ‚Ä¢ <code className="bg-gray-100 px-2 py-1 rounded text-sm">train</code>: Array of video filenames for training<br/>
                            ‚Ä¢ <code className="bg-gray-100 px-2 py-1 rounded text-sm">val</code>: Array of video filenames for validation<br/>
                            ‚Ä¢ <code className="bg-gray-100 px-2 py-1 rounded text-sm">inference</code>: Array of video filenames for inference of the trained model<br/>
                            <strong>Note:</strong> Train and val filenames must have corresponding entries in the <code className="bg-gray-100 px-2 py-1 rounded text-sm">labels</code> section
                        </p>
                    </div>
                </div>

                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">Requirements</h3>
                <ul className="text-gray-700 leading-relaxed space-y-2">
                    <li><strong>Consistency:</strong> All video files referenced in train and val splits must have corresponding label data in <code className="bg-gray-100 px-2 py-1 rounded text-sm">labels</code></li>
                    <li><strong>Valid Class IDs:</strong> All integers in label arrays must exist as keys in <code className="bg-gray-100 px-2 py-1 rounded text-sm">class_names</code></li>
                    <li><strong>File Extensions:</strong> Video filenames should include the extension (e.g. .mp4)</li>
                    <li><strong>Array Length:</strong> Each label array must be the same length as the frame count of its video </li>
                </ul>

                <div className="mt-6 rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-blue-100/70 p-4">
                    <p className="text-blue-900 text-sm leading-relaxed">
                      <span className="mr-1" role="img" aria-label="Light bulb">üí°</span>
                      <strong className="font-semibold">Tip:</strong>
                      {" "}
                      Not sure your JSON is valid? Try uploading it to our{" "}
                      <button
                        type="button"
                        onClick={() => handleNavClick("dataset-validator")}
                        className="inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium text-blue-700 bg-white/70 hover:bg-white shadow-sm ring-1 ring-inset ring-blue-300 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
                      >
                        Label Validation Tool
                      </button>
                    </p>
                  </div>

                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">üîÑ Converting Existing Annotations to FERAL Format</h3>
                <p className="text-gray-700 leading-relaxed mb-4">
                    FERAL doesn‚Äôt come with a built-in annotation interface. Instead, it integrates directly with the BORIS behavioral-annotation software. 
                    If you use another tool, let us know and we‚Äôll add support for it.
                </p>

                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                    <p className="text-yellow-800 font-medium">
                        ‚ö†Ô∏è <strong>Important:</strong> When converting annotations, ensure that video filenames in your annotation data 
                        match the re-encoded video files (with .mp4 extensions) rather than the original raw video file names.
                    </p>
                </div>

                <h4 className="text-lg font-semibold text-gray-800 mt-6 mb-3">BORIS to JSON Conversion Script</h4>
                <p className="text-gray-700 leading-relaxed mb-4">
                    Here's a conversion script for BORIS TSV files that produces the correct JSON structure:
                </p>

                <div className="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-x-auto">
                    <pre><code>{`import pandas as pd
import json
import re
from pathlib import Path

def convert_tsv_to_json(tsv_folder_path):
    # Define the behavioral mapping
    behavior_to_class = {
        "contact": 1,
        "attempt": 2,
        "flight": 3,
        "kicking": 4,
        "genital contact": 5,
        "mating": 6
    }
    
    # Initialize the output structure
    out = {
        "class_names": {
            "0": "other",
            "1": "contact",
            "2": "attempt",
            "3": "flight",
            "4": "kicking",
            "5": "genital_contact",
            "6": "mating"
        },
        "labels": {},
        "splits": {
            "train": [],
            "val": []
        }
    }
    
    # Process each TSV file
    for tsv_file in Path(tsv_folder_path).glob("*.tsv"):
        df = pd.read_csv(tsv_file, sep='\\t')
        video_name = re.sub(r'_(Virgin|Mated)$', '', tsv_file.stem) + '.mp4'
        
        # Extract video properties
        duration = df['Media duration (s)'].iloc[0]
        fps = df['FPS'].iloc[0]
        total_frames = round(duration * fps)
        frame_labels = [0] * total_frames
        active_behaviors = {}
        
        # Process each row in the TSV
        for _, row in df.iterrows():
            behavior = row['Behavior']
            behavior_type = row['Behavior type']
            time_sec = row['Time']
            
            if pd.isna(behavior) or behavior == 'start' or behavior_type == 'POINT':
                continue
                
            frame_num = int(time_sec * fps)
            
            if behavior_type == 'START':
                active_behaviors[behavior] = frame_num
            elif behavior_type == 'STOP' and behavior in active_behaviors:
                start_frame = active_behaviors[behavior]
                end_frame = frame_num
                behavior_class = behavior_to_class.get(behavior, 0)
                
                # Label frames between start and end
                for frame in range(start_frame, min(end_frame + 1, total_frames)):
                    if frame_labels[frame] == 0 or behavior_class > frame_labels[frame]:
                        frame_labels[frame] = behavior_class
                        
                del active_behaviors[behavior]
        
        # Add to output structure
        out["labels"][video_name] = frame_labels
        
        # Assign to train/val split (alternating for simplicity)
        if len(out["splits"]["train"]) <= len(out["splits"]["val"]):
            out["splits"]["train"].append(video_name)
        else:
            out["splits"]["val"].append(video_name)
    
    # Save the output
    output_path = Path(tsv_folder_path) / "feral_behavioral_labels.json"
    with open(output_path, 'w') as f:
        json.dump(out, f, indent=2)
    
    return out

# Usage example:
# convert_tsv_to_json("/path/to/your/tsv/files")`}</code></pre>
                </div>

                <div className="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
                    <p className="text-yellow-800 font-medium">
                        ‚ö†Ô∏è <strong>Note:</strong> This script assumes your BORIS TSV files contain columns for 'Media duration (s)', 'FPS', 'Behavior', 'Behavior type', and 'Time'. 
                        Make sure the files contain these columns.
                    </p>
                </div>

            </section>
        );
  

        const RunningFeralSection = ({ handleNavClick }) => (
            <section id="running-feral" className="bg-white p-8 rounded-lg shadow-md mb-8">
                <h2 className="text-3xl font-bold text-gray-900 mb-4">Running Feral AI</h2>
              
                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">Locally</h3>
                <p className="text-gray-700 leading-relaxed">
                  0. Make sure that you have installed:<br />
                  &nbsp;&nbsp;- Python&nbsp;3.10<br />
                  &nbsp;&nbsp;- PyTorch&nbsp;2.4.0<br />
                  &nbsp;&nbsp;- CUDA&nbsp;12.4<br />
                  You can try running with newer/older versions, maybe it will work.<br /><br />
                  1. Clone the repo:&nbsp;
                  <code className="font-mono break-all">git clone https://github.com/Skovorp/feral.git</code><br />
                  2. <code className="font-mono">cd feral</code><br />
                  3. <code className="font-mono">pip install -r requirements.txt</code><br />
                  4. Now you can run Feral!<br />
                  &nbsp;&nbsp;<code className="font-mono">
                    python run.py path_to_folder_with_reencoded_videos&nbsp;path_to_labels_json
                  </code><br /><br />
                  To track the logs of your run, we use <strong>wandb</strong>. After you start your run, you can either
                  use the shared <em>feral</em> workspace or paste your personal wandb API key. You can copy it after you
                  sign up at&nbsp;
                  <a href="https://wandb.ai/authorize" className="text-blue-600 hover:underline" rel="noopener noreferrer">
                    https://wandb.ai/authorize
                  </a>.
                </p>
              
                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">RunPod</h3>
                <p className="text-gray-700 leading-relaxed">
                  1. Get your own RunPod account with about&nbsp;$10 on it, or contact us and we'll give you an account with some credit.<br />
                  2. Go to&nbsp;
                  <a
                    href="https://console.runpod.io/deploy?gpu=H100%20SXM&count=1&template=runpod-torch-v240"
                    className="text-blue-600 hover:underline"
                    rel="noopener noreferrer"
                  >
                    this RunPod deploy link
                  </a>
                  . Make sure <em>SSH Terminal Access</em> and <em>Start Jupyter Notebook</em> are selected. Depending on the size of your data, you might want to increase disk size in <em>Edit&nbsp;Template&nbsp;&rarr;&nbsp;Volume&nbsp;Disk</em>.<br />
                  3. Then go to ‚ÄúMy&nbsp;Pods‚Äù (https://console.runpod.io/pods) and wait a little bit. Once the server is set up, click <em>Connect</em> and open the <em>Jupyter&nbsp;Lab</em> ‚Üí :8888 button.<br />
                  4. This should open a Jupyter Lab interface on your remote server. If it doesn't work, turn on a VPN.<br />
                  5. At the bottom, in the ‚ÄúOther‚Äù section, click <em>Terminal</em>.<br />
                  6. Run the following commands:<br />
                  &nbsp;&nbsp;<code className="font-mono">
                    git clone https://github.com/Skovorp/feral.git<br />
                    cd feral<br />
                    pip install -r requirements.txt
                  </code><br />
                  7. While it‚Äôs running, create a folder for the videos, then drag and drop your videos into it.<br />
                  8. Also copy your config for the labels.<br />
                  9. Run:&nbsp;
                  <code className="font-mono">
                    python run.py path_to_folder_with_reencoded_videos&nbsp;path_to_labels_json
                  </code>
                </p>
              
                <h3 className="text-2xl font-semibold text-gray-800 mt-6 mb-3">Final results</h3>
                <p className="text-gray-700 leading-relaxed">
                  In the end you'll get an&nbsp;<code className="font-mono">_inference_&#123;run_name&#125;_&#123;%Y-%m-%d_%H-%M-%S&#125;.json</code> file inside your "answers" folder
                  with predictions for your inference videos.
                </p>
              </section>
        );

        const DatasetValidatorSection = () => {
            const [file, setFile] = useState(null);
            const [validationResult, setValidationResult] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleFileChange = (event) => {
                setFile(event.target.files[0]);
                setValidationResult(null);
                setError(null);
            };

            const validateFeralDataset = (data) => {
                const issues = [];
                const warnings = [];
                let isValid = true;

                // Check required top-level keys
                const requiredKeys = ['class_names', 'labels', 'splits'];
                for (const key of requiredKeys) {
                    if (!(key in data)) {
                        issues.push(`Missing required key: "${key}"`);
                        isValid = false;
                    }
                }

                if (!isValid) {
                    return { isValid: false, issues, warnings, metadata: null };
                }


                // Validate class_names
                if (typeof data.class_names !== 'object' || Array.isArray(data.class_names)) {
                    issues.push('class_names must be an object');
                    isValid = false;
                } else {
                    const classIds = Object.keys(data.class_names);
                    if (classIds.length === 0) {
                        issues.push('class_names cannot be empty');
                        isValid = false;
                    }
                }

                // Validate labels structure
                if (typeof data.labels !== 'object' || Array.isArray(data.labels)) {
                    issues.push('labels must be an object');
                    isValid = false;
                } else {
                    const videoFiles = Object.keys(data.labels);
                    if (videoFiles.length === 0) {
                        issues.push('labels cannot be empty');
                        isValid = false;
                    }
                }

                // Validate splits structure
                if (typeof data.splits !== 'object' || Array.isArray(data.splits)) {
                    issues.push('splits must be an object');
                    isValid = false;
                } else {
                    if (!Array.isArray(data.splits.train)) {
                        issues.push('splits.train must be an array');
                        isValid = false;
                    }
                    if (!Array.isArray(data.splits.val)) {
                        issues.push('splits.val must be an array');
                        isValid = false;
                    }
                }

                if (!isValid) {
                    return { isValid: false, issues, warnings, metadata: null };
                }

                // Detailed validation and metadata extraction
                const classIds = Object.keys(data.class_names);
                const videoFiles = Object.keys(data.labels);
                const trainFiles = data.splits.train || [];
                const valFiles = data.splits.val || [];
                const allSplitFiles = [...trainFiles, ...valFiles];

                // Check consistency between labels and splits
                const missingInLabels = allSplitFiles.filter(f => !videoFiles.includes(f));
                const missingInSplits = videoFiles.filter(f => !allSplitFiles.includes(f));
                
                if (missingInLabels.length > 0) {
                    issues.push(`Files in splits but missing in labels: ${missingInLabels.join(', ')}`);
                }
                if (missingInSplits.length > 0) {
                    warnings.push(`Files in labels but missing in splits: ${missingInSplits.join(', ')}`);
                }

                // Check for duplicate files in splits
                const duplicates = trainFiles.filter(f => valFiles.includes(f));
                if (duplicates.length > 0) {
                    issues.push(`Files appear in both train and val splits: ${duplicates.join(', ')}`);
                }

                // Analyze labels for each video
                const videoMetadata = {};
                const behaviorCounts = {};
                const classCounts = {};

                // Initialize behavior counts
                Object.values(data.class_names).forEach(behavior => {
                    behaviorCounts[behavior] = 0;
                });

                // Initialize class counts
                classIds.forEach(id => {
                    classCounts[id] = 0;
                });

                for (const [videoFile, labelArray] of Object.entries(data.labels)) {
                    if (!Array.isArray(labelArray)) {
                        issues.push(`Labels for "${videoFile}" must be an array`);
                        continue;
                    }

                    const frameCount = labelArray.length;
                    const videoBehaviorCounts = {};
                    const videoClassCounts = {};

                    // Initialize counts for this video
                    Object.values(data.class_names).forEach(behavior => {
                        videoBehaviorCounts[behavior] = 0;
                    });
                    classIds.forEach(id => {
                        videoClassCounts[id] = 0;
                    });

                    // Count occurrences
                    labelArray.forEach(label => {
                        const labelStr = String(label);
                        if (!classIds.includes(labelStr)) {
                            issues.push(`Invalid class ID "${label}" in video "${videoFile}"`);
                            return;
                        }
                        
                        const behaviorName = data.class_names[labelStr];
                        videoBehaviorCounts[behaviorName]++;
                        videoClassCounts[labelStr]++;
                        behaviorCounts[behaviorName]++;
                        classCounts[labelStr]++;
                    });

                    videoMetadata[videoFile] = {
                        frameCount,
                        behaviorCounts: videoBehaviorCounts,
                        classIdCounts: videoClassCounts,
                        split: trainFiles.includes(videoFile) ? 'train' : 
                               valFiles.includes(videoFile) ? 'val' : 'unassigned'
                    };
                }

                const metadata = {
                    totalVideos: videoFiles.length,
                    trainVideos: trainFiles.length,
                    valVideos: valFiles.length,
                    totalClasses: classIds.length,
                    classNames: data.class_names,
                    totalFrames: Object.values(videoMetadata).reduce((sum, meta) => sum + meta.frameCount, 0),
                    behaviorCounts,
                    classCounts,
                    videoMetadata
                };

                return {
                    isValid: issues.length === 0,
                    issues,
                    warnings,
                    metadata
                };
            };

            const validateDataset = async () => {
                if (!file) {
                    setError("Please select a file to validate.");
                    return;
                }

                setIsLoading(true);
                setError(null);
                setValidationResult(null);

                try {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const fileContent = e.target.result;
                        let result = {};

                        if (file.name.endsWith('.json')) {
                            try {
                                const data = JSON.parse(fileContent);
                                const validation = validateFeralDataset(data);
                                
                                result = {
                                    status: validation.isValid ? 'success' : 'error',
                                    message: validation.isValid ? 
                                        `JSON file "${file.name}" is valid!` : 
                                        `JSON file "${file.name}" has validation errors.`,
                                    details: validation.isValid ? 
                                        'All required fields are present and properly formatted.' : 
                                        'Please fix the issues listed below.',
                                    issues: validation.issues,
                                    warnings: validation.warnings,
                                    metadata: validation.metadata
                                };
                            } catch (parseError) {
                                result = {
                                    status: 'error',
                                    message: `Invalid JSON format for file "${file.name}".`,
                                    details: parseError.message,
                                    issues: ['JSON parsing error'],
                                    warnings: [],
                                    metadata: null
                                };
                            }
                        } else {
                            result = {
                                status: 'info',
                                message: `File "${file.name}" is not a JSON file.`,
                                details: 'Please upload a JSON file for FERAL dataset validation.',
                                issues: ['Wrong file format'],
                                warnings: [],
                                metadata: null
                            };
                        }
                        setValidationResult(result);
                        setIsLoading(false);
                    };
                    reader.readAsText(file);
                } catch (err) {
                    setError(`An unexpected error occurred: ${err.message}`);
                    setIsLoading(false);
                }
            };

            return (
                <section id="dataset-validator" className="bg-white p-8 rounded-lg shadow-md mb-8">
                    <h2 className="text-3xl font-bold text-gray-900 mb-4">Dataset Validator</h2>
                    <p className="text-gray-700 leading-relaxed mb-6">
                        Upload your FERAL dataset JSON file to validate its structure and get detailed analysis including 
                        frame counts, behavior distributions, and format compliance.
                    </p>

                    <div className="mb-6">
                        <label htmlFor="file-upload" className="block text-sm font-medium text-gray-700 mb-2">
                            Upload your dataset JSON file:
                        </label>
                        <input
                            id="file-upload"
                            type="file"
                            accept=".json"
                            onChange={handleFileChange}
                            className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-200 file:text-gray-700 hover:file:bg-gray-300"
                        />
                        {file && (
                            <p className="mt-2 text-sm text-gray-600">Selected file: <span className="font-medium">{file.name}</span></p>
                        )}
                    </div>

                    <button
                        onClick={validateDataset}
                        disabled={!file || isLoading}
                        className={`bg-gray-900 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1 ${(!file || isLoading) ? 'opacity-50 cursor-not-allowed' : ''}`}
                    >
                        {isLoading ? 'Validating...' : 'Validate Dataset'}
                    </button>

                    {error && (
                        <div className="mt-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md" role="alert">
                            <p className="font-bold">Error:</p>
                            <p>{error}</p>
                        </div>
                    )}

                    {validationResult && (
                        <div className="mt-6 space-y-6">
                            {/* Main validation result */}
                            <div className={`p-6 rounded-lg shadow-inner ${validationResult.status === 'success' ? 'bg-green-50 border-green-400' : validationResult.status === 'error' ? 'bg-red-50 border-red-400' : 'bg-gray-50 border-gray-400'} border-l-4`}>
                                <h3 className={`text-xl font-bold mb-2 ${validationResult.status === 'success' ? 'text-green-700' : validationResult.status === 'error' ? 'text-red-700' : 'text-gray-700'}`}>
                                    {validationResult.status === 'success' ? '‚úÖ Validation Successful!' : 
                                     validationResult.status === 'error' ? '‚ùå Validation Failed' : '‚ÑπÔ∏è Information'}
                                </h3>
                                <p className="text-gray-800 mb-2">{validationResult.message}</p>
                                {validationResult.details && <p className="text-gray-600 text-sm">{validationResult.details}</p>}
                            </div>

                            {/* Issues and Warnings */}
                            {(validationResult.issues?.length > 0 || validationResult.warnings?.length > 0) && (
                                <div className="space-y-4">
                                    {validationResult.issues?.length > 0 && (
                                        <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                                            <h4 className="font-semibold text-red-700 mb-2">‚ùå Issues Found:</h4>
                                            <ul className="list-disc list-inside text-red-600 space-y-1">
                                                {validationResult.issues.map((issue, index) => (
                                                    <li key={index}>{issue}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}
                                    
                                    {validationResult.warnings?.length > 0 && (
                                        <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                            <h4 className="font-semibold text-yellow-700 mb-2">‚ö†Ô∏è Warnings:</h4>
                                            <ul className="list-disc list-inside text-yellow-600 space-y-1">
                                                {validationResult.warnings.map((warning, index) => (
                                                    <li key={index}>{warning}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Dataset Metadata */}
                            {validationResult.metadata && (
                                <div className="space-y-6">
                                    <h3 className="text-xl font-bold text-gray-900">üìä Dataset Analysis</h3>
                                    
                                    {/* Summary Statistics */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                            <h4 className="font-semibold text-blue-700">Total Videos</h4>
                                            <p className="text-2xl font-bold text-blue-800">{validationResult.metadata.totalVideos}</p>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                                            <h4 className="font-semibold text-green-700">Training Videos</h4>
                                            <p className="text-2xl font-bold text-green-800">{validationResult.metadata.trainVideos}</p>
                                        </div>
                                        <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                            <h4 className="font-semibold text-purple-700">Validation Videos</h4>
                                            <p className="text-2xl font-bold text-purple-800">{validationResult.metadata.valVideos}</p>
                                        </div>
                                        <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                            <h4 className="font-semibold text-orange-700">Total Frames</h4>
                                            <p className="text-2xl font-bold text-orange-800">{validationResult.metadata.totalFrames.toLocaleString()}</p>
                                        </div>
                                    </div>

                                    {/* Class Distribution */}
                                    <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                        <h4 className="font-semibold text-gray-700 mb-4">üéØ Behavior Distribution</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {Object.entries(validationResult.metadata.behaviorCounts).map(([behavior, count]) => (
                                                <div key={behavior} className="flex justify-between items-center p-3 bg-white rounded border">
                                                    <span className="font-medium text-gray-700 capitalize">{behavior}</span>
                                                    <span className="text-lg font-bold text-gray-900">{count.toLocaleString()}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Per-Video Analysis */}
                                    <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                        <h4 className="font-semibold text-gray-700 mb-4">üìπ Per-Video Analysis</h4>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm text-left text-gray-500 border border-gray-200">
                                                <thead className="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th className="px-4 py-2 border-b">Video File</th>
                                                        <th className="px-4 py-2 border-b">Split</th>
                                                        <th className="px-4 py-2 border-b">Frames</th>
                                                        <th className="px-4 py-2 border-b">Behaviors</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {Object.entries(validationResult.metadata.videoMetadata).map(([videoFile, meta]) => (
                                                        <tr key={videoFile} className="bg-white border-b hover:bg-gray-50">
                                                            <td className="px-4 py-2 font-medium text-gray-900">{videoFile}</td>
                                                            <td className="px-4 py-2">
                                                                <span className={`px-2 py-1 text-xs rounded-full ${meta.split === 'train' ? 'bg-green-100 text-green-800' : meta.split === 'val' ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'}`}>
                                                                    {meta.split}
                                                                </span>
                                                            </td>
                                                            <td className="px-4 py-2">{meta.frameCount.toLocaleString()}</td>
                                                            <td className="px-4 py-2">
                                                                <div className="flex flex-wrap gap-1">
                                                                    {Object.entries(meta.behaviorCounts)
                                                                        .filter(([_, count]) => count > 0)
                                                                        .map(([behavior, count]) => (
                                                                            <span key={behavior} className="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">
                                                                                {behavior}: {count}
                                                                            </span>
                                                                        ))
                                                                    }
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    {/* Dataset Health Score */}
                                    <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border border-blue-200">
                                        <h4 className="font-semibold text-gray-700 mb-4">üè• Dataset Health Summary</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-green-600">
                                                    {validationResult.metadata.trainVideos > 0 && validationResult.metadata.valVideos > 0 ? '‚úÖ' : '‚ùå'}
                                                </div>
                                                <p className="text-sm text-gray-600">Train/Val Split</p>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-green-600">
                                                    {Object.values(validationResult.metadata.behaviorCounts).every(count => count > 0) ? '‚úÖ' : '‚ö†Ô∏è'}
                                                </div>
                                                <p className="text-sm text-gray-600">All Behaviors Present</p>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-green-600">
                                                    {validationResult.metadata.totalFrames > 1000 ? '‚úÖ' : '‚ö†Ô∏è'}
                                                </div>
                                                <p className="text-sm text-gray-600">Sufficient Data</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </section>
            );
        };

        const ExamplesSection = () => (
            <section id="examples" className="bg-white p-8 rounded-lg shadow-md mb-8">
                <h2 className="text-3xl font-bold text-gray-900 mb-4">Examples</h2>
                <p className="text-gray-700 leading-relaxed">
                    Browse through various examples demonstrating how to use Feral AI for different
                    behavioral analysis tasks.
                </p>
                <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-gray-50 p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 className="text-xl font-semibold text-gray-800 mb-2">Rodent Locomotion</h3>
                        <p className="text-gray-600 text-sm">
                            Example demonstrating tracking and segmenting locomotion patterns in rodents.
                        </p>
                    </div>
                </div>
            </section>
        );

        const ContactSection = () => {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                subject: '',
                message: ''
            });

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Create mailto link with both recipients
                const recipients = 'jrazzauti@rockefeller.edu,pskovorodnikov@rockefeller.edu';
                const subject = encodeURIComponent(formData.subject || 'FERAL AI Inquiry');
                const body = encodeURIComponent(
                    `Name: ${formData.name}\n` +
                    `Email: ${formData.email}\n\n` +
                    `Message:\n${formData.message}`
                );
                
                const mailtoLink = `mailto:${recipients}?subject=${subject}&body=${body}`;
                window.location.href = mailtoLink;
            };

            const sendDirectEmail = (email, name) => {
                const subject = encodeURIComponent('FERAL AI Inquiry');
                const body = encodeURIComponent(`Hello ${name},\n\nI have a question about FERAL AI:\n\n`);
                const mailtoLink = `mailto:${email}?subject=${subject}&body=${body}`;
                window.location.href = mailtoLink;
            };

            return (
                <section id="contact" className="bg-white p-8 rounded-lg shadow-md mb-8">
                    <h2 className="text-3xl font-bold text-gray-900 mb-4">Contact Us</h2>
                    <p className="text-gray-700 leading-relaxed mb-8">
                        Have questions about FERAL? Need help with your research or implementation? 
                        We're here to help! Reach out to us for support, collaborations, or any inquiries.
                    </p>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* Contact Form */}
                        <div>
                            <h3 className="text-2xl font-semibold text-gray-900 mb-6">üìß Send us a Message</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-2">
                                        Your Name *
                                    </label>
                                    <input
                                        type="text"
                                        id="name"
                                        name="name"
                                        required
                                        value={formData.name}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Enter your full name"
                                    />
                                </div>

                                <div>
                                    <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-2">
                                        Your Email *
                                    </label>
                                    <input
                                        type="email"
                                        id="email"
                                        name="email"
                                        required
                                        value={formData.email}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="your.email@institution.edu"
                                    />
                                </div>

                                <div>
                                    <label htmlFor="subject" className="block text-sm font-medium text-gray-700 mb-2">
                                        Subject
                                    </label>
                                    <input
                                        type="text"
                                        id="subject"
                                        name="subject"
                                        value={formData.subject}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Brief description of your inquiry"
                                    />
                                </div>

                                <div>
                                    <label htmlFor="message" className="block text-sm font-medium text-gray-700 mb-2">
                                        Message *
                                    </label>
                                    <textarea
                                        id="message"
                                        name="message"
                                        required
                                        rows="6"
                                        value={formData.message}
                                        onChange={handleInputChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"
                                        placeholder="Tell us about your project, questions, or how we can help..."
                                    ></textarea>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full bg-gray-900 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1"
                                >
                                    üìß Send Message
                                </button>
                            </form>

                            <p className="text-sm text-gray-600 mt-4">
                                * This will open your default email client to send the message
                            </p>
                        </div>

                        {/* Direct Contact & Team Info */}
                        <div className="space-y-6">
                            <div>
                                <h3 className="text-2xl font-semibold text-gray-900 mb-6">üë• Acknowledgments</h3>
                                
                                {/* Team Member 1 */}
                                <div className="bg-blue-50 p-6 rounded-lg border border-blue-200 mb-4">
                                    <h4 className="text-lg font-semibold text-blue-900 mb-2">
                                        üß¨ Jacopo Razzauti
                                    </h4>
                                    <p className="text-sm text-blue-700 mb-3">
                                        Researcher & Co-Developer
                                    </p>
                                    <button
                                        onClick={() => sendDirectEmail('jrazzauti@rockefeller.edu', 'Jacopo')}
                                        className="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 text-sm"
                                    >
                                        ‚úâÔ∏è jrazzauti@rockefeller.edu
                                    </button>
                                </div>

                                {/* Team Member 2 */}
                                <div className="bg-green-50 p-6 rounded-lg border border-green-200">
                                    <h4 className="text-lg font-semibold text-green-900 mb-2">
                                        ü§ñ Peter Skovorodnikov
                                    </h4>
                                    <p className="text-sm text-green-700 mb-3">
                                        Researcher & Lead Developer
                                    </p>
                                    <button
                                        onClick={() => sendDirectEmail('pskovorodnikov@rockefeller.edu', 'Peter')}
                                        className="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 text-sm"
                                    >
                                        ‚úâÔ∏è pskovorodnikov@rockefeller.edu
                                    </button>
                                </div>
                            </div>

                            {/* Institution Info */}
                            <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <div className="flex items-center mb-2">
                                    <span className="mr-2">üèõÔ∏è</span>
                                    <span className="font-semibold text-blue-900">The Rockefeller University</span>
                                </div>
                                <p className="text-sm text-blue-700">
                                    Data Science Platform <br/>
                                    Laboratory of Neurogenetics and Behavior<br/>
                                    1230 York Avenue, New York, NY 10065
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        const FAQSection = () => (
            <section id="faq" className="bg-white p-8 rounded-lg shadow-md mb-8">
                <h2 className="text-3xl font-bold text-gray-900 mb-4">Frequently Asked Questions</h2>
                <div className="space-y-4">
                    <details className="group border-b border-gray-200 pb-4">
                        <summary className="flex justify-between items-center cursor-pointer text-lg font-semibold text-gray-800">
                            How accurate is Feral AI?
                            <svg className="h-5 w-5 text-gray-500 group-open:rotate-180 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <p className="mt-2 text-gray-600">
                            Feral leverages state-of-the-art deep learning models, achieving high accuracy comparable to,
                            and often exceeding, manual annotation for a wide range of behaviors. Accuracy can vary based on
                            video quality and specific behavioral complexity.
                        </p>
                    </details>
                    <details className="group border-b border-gray-200 pb-4">
                        <summary className="flex justify-between items-center cursor-pointer text-lg font-semibold text-gray-800">
                            What video formats are supported?
                            <svg className="h-5 w-5 text-gray-500 group-open:rotate-180 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <p className="mt-2 text-gray-600">
                            Feral AI supports common video formats such as MP4, AVI, MOV, and MKV. For best results,
                            we recommend using high-resolution videos with stable lighting.
                        </p>
                    </details>
                </div>
            </section>
        );

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
